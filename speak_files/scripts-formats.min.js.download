var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Item(e,t){window.viewMode=window.viewMode||"solve",window.studentAnswers=window.studentAnswers||!1,window.resumedAnswers=window.resumedAnswers||!1,window.learnosityActivityData=window.learnosityActivityData||{},this.object=e,this.id=t}Function.prototype.getInstance=function(){function e(){}return e.prototype=this.prototype,new e},$.extend(Item.prototype,{responseIdPattern:/response\[.*\]\[(.*)\]/,getCorrectResponses:function(e){return"undefined"!=typeof correctAnswers&&!1!==correctAnswers&&correctAnswers[this.id][e]},getCorrectResponse:function(e){var t=this.getCorrectResponses(e);return!1!==t&&(t?t[0]:null)},getResponseIdForInput:function(e){return e instanceof jQuery||(e=$(e)),e.attr("id").substr(this.id.length+1)},getStudentAnswers:function(e){return"undefined"!=typeof studentAnswers&&!1!==studentAnswers&&(void 0!==studentAnswers[this.id]&&(void 0!==studentAnswers[this.id][e]&&studentAnswers[this.id][e]))},getResumedAnswers:function(e){return"undefined"!=typeof resumedAnswers&&!1!==resumedAnswers&&(void 0!==resumedAnswers[this.id]&&(void 0!==resumedAnswers[this.id][e]&&resumedAnswers[this.id][e]))},onShow:function(){this.prepareView(),this.init(),this.prepareEvents()},onReport:function(){this.addFeedbacks(),this.loadReport()},addFeedbacks:function(){this.object.find('[name^="response['+this.id+']"]').each(function(e,t){if(!$(t).is(":disabled")){var n=$(t).attr("name").match(this.responseIdPattern)[1];!0,this.addFeedback(n)}}.bind(this))},prepareView:function(){"use strict";var e=function(){this.loadSolve(),this.loadResumedAnswers()}.bind(this);switch(!0){case"preview"==window.viewMode:this.loadPreview();break;case"report"==window.viewMode:this.onReport();break;case"solve"==window.viewMode:e();break;default:e()}this.migrationFix()},migrationFix:function(){this.object.find(".example-holder").parent().addClass("migration-example"),this.object.find(".example-table").parent().addClass("migration-example-table")},insertStudentAnswers:function(e,t,n){var s=(n=n||{})._hideOnly||!1,r=n._clone||!1,a=n._answers||!1;if(e instanceof jQuery||(e=$(e)),t.length)for(i in t){var o=$("<span>").addClass(t[i]._class).append(t[i]._value);null!=t[i]._typeClass&&o.addClass(t[i]._typeClass),o[0].setAttribute("aria-hidden",!0),e.after(o),a&&this.addAlternativeAnswers(o,a)}var d=this.createAriaElement(n.answer_type,t,!!a);e.before(d),!1!==r&&e.after($("<input/>").attr("type","hidden").attr("name",e.attr("name")).val(r)),s?e.hide():e.remove()},createAriaElement:function(e,t,n){var s,r="incorrect.answer",i="no.answer",a="wrongAnswer",u="noAnswer",p="unavailableAnswer";function o(e,t,n,s){var r,i,a,o="";function d(e){if(/<[a-z][\s\S]*>/i.test(e)){var n="";$(e).text(function(e,t){n=n+t+" "}),e=n}return e}function c(e,t){return"noAnswer"!==t&&(e=": "+e),e}function l(e,t){return e.filter(function(e){return e._class===t})[0]._value}return o=t?(i=n!==u?(o=l(e,n),l(e,p)):l(e,n),o=d(o),a=i,c(o=o+". "+ExposeTranslation.trans("activity.system.answer.is")+": "+a,n)):(n!==u&&(o=l(e,n)),c(o=d(o),n)),(r=document.createElement("p")).className="visually-hidden",r.innerHTML=ExposeTranslation.trans(s)+o,r}return e==="correctAnswer"?s=o(t,!1,e,"correct.answer"):e===a?s=o(t,n,e,r):e===u&&(s=o(t,n,e,i)),s},addAlternativeAnswers:function(e,t){var n,s=t.length;if(e=$(e),s){var r="";$.each(t,function(e,t){r+="<li>"+t+"</li>"}),n=1<s?ExposeTranslation.trans("correct.answers"):ExposeTranslation.trans("correct.answer"),e.append('<div class="alternativeAnswersContent"><ul><b>'+n+"</b>"+r+"</ul></div>")}},addFeedback:function(e){var t,n,s=this.getStudentAnswers(e)||!1;s&&"string"==typeof(t=this.getFeedbackValue(s))&&t.length&&(n=s.correct?"specificCorrectFeedback":"specificWrongFeedback",this.object.find('[name="response['+this.id+"]["+e+']"]').after('<div class="buttonFeedback '+n+'"><div class="feedbackContent">'+t+"</div></div>"))},loadResumedAnswers:function(){var e=this;resumedAnswers&&this.object.find('[name^="response"]').each(function(){e.insertResumedAnswer($(this))})},insertResumedAnswer:function(e){if(!e.next().hasClass("correctAnswer")){var t=this.getResumedAnswers(this.getResponseIdForInput(e));t.values&&t.values[0]&&e.val($("<div/>").html(t.values[0].value).text())}},getFeedbackValue:function(e){var t="";return e&&e.feedback&&e.feedback[0]&&(t=e.feedback[0]),t},determineCorrectness:function(){},prepareEvents:function(){},loadPreview:function(){},loadReport:function(){},loadSolve:function(){},init:function(){},prepareToSend:function(){},afterPrepareToSend:function(){},checkFilledAnswers:function(){return!0}}),$.extend(Item,{EMPTY_GAP:"_____",extend:function(e,t){"use strict";var n=$.extend(e.getInstance(),t);return n._super=e.getInstance(),n},getItemId:function(e){return $(e).parents(".item").attr("id").replace("item","")},getJQueryObject:function(e){return $(e)},get:function(e){return ItemFactory.getItem(e)},getAll:function(e){return(e||$("body")).find(".itemContent").toArray().map(this.get.bind(this))},checkifPromptneeded:function(){var n=!1;return $.each(this.getAll(),function(e,t){n||t.checkFilledAnswers()||(n=!0)}),n},inTeacherGradedActivityWithModelAnswer:function(){return!!$("#showModelAnswer").length}});var ItemFactory={instances:{},getItem:function(e){var t=Item.getJQueryObject(e),n=Item.getItemId(t);if(!this.instances[n]){var s=this.getSpecificFormatConstructor(t);this.instances[n]=new s(t,n)}return this.instances[n]},getSpecificFormatConstructor:function(e){if(window.isPrimary)switch(!0){case e.hasClass("matching"):return PrimaryMatching;case e.hasClass("dragAndDrop"):return PrimaryDragAndDropItem;case e.hasClass("positionalDragAndDrop"):return PrimaryPositionalDragAndDropItem;case e.hasClass("dragAndDropCategorisation"):return CategorisationDragAndDropItem;case e.hasClass("draggableJumbledWords"):return PrimaryDraggableJumbledWordsItem;case e.hasClass("singleUnderline"):return SingleUnderlineItem;case e.hasClass("multipleUnderline"):return MultipleUnderlineItem;case e.hasClass("fillin"):return FillinItem;case e.hasClass("inlineDropDown"):return InlineDropDownItem;case e.hasClass("wordsearch"):return WordsearchItem;case e.hasClass("crossword"):return CrosswordItem;case e.hasClass("singleChoice"):return PrimarySingleChoice;case e.hasClass("multipleChoice"):return PrimaryMultipleChoiceItem;case e.hasClass("fillinTable"):return FillinTableItem}switch(!0){case e.hasClass("fillin"):return FillinItem;case e.hasClass("multipleChoice"):return MultipleChoiceItem;case e.hasClass("singleChoice"):return SingleChoiceItem;case e.hasClass("essay"):return EssayItem;case e.hasClass("audiosubmit"):return AudiosubmitItem;case e.hasClass("dropDown"):return DropDownItem;case e.hasClass("inlineDropDown"):return InlineDropDownItem;case e.hasClass("dragAndDrop"):return DragAndDropItem;case e.hasClass("positionalDragAndDrop"):return PositionalDragAndDropItem;case e.hasClass("dragAndDropCategorisation"):return CategorisationDragAndDropItem;case e.hasClass("draggableJumbledWords"):return DraggableJumbledWordsItem;case e.hasClass("singleUnderline"):return SingleUnderlineItem;case e.hasClass("multipleUnderline"):return MultipleUnderlineItem;case e.hasClass("matching"):return MatchingItem;case e.hasClass("hangman"):return HangmanItem;case e.hasClass("wordsearch"):return WordsearchItem;case e.hasClass("crossword"):return CrosswordItem;case e.hasClass("firstLetterFillin"):return FirstLetterItem;case e.hasClass("fillinTable"):return FillinTableItem;case e.hasClass("insertAWord"):return InsertAWordItem;case e.hasClass("conversation"):case e.hasClass("describeImage"):case e.hasClass("readingAndSpeaking"):case e.hasClass("listenAndRepeat"):case e.hasClass("storyRetell"):case e.hasClass("passageComprehension"):return PSEAudiosubmitItem;case e.hasClass("dictation"):return DictationItem;case e.hasClass("reorder"):return ReorderItem;case e.hasClass("recallAPassage"):return RecallAPassageItem;case e.hasClass("shortWriting"):return ShortWritingItem;case e.hasClass("errorCorrection"):return ErrorCorrectionItem}return Item}};function ValueItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function FirstLetterItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function FillinTableItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function ChoiceItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function SingleChoiceItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function AudiosubmitItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}ValueItem.prototype=$.extend(Item.getInstance(),{classes:{example:"exampleAnswer",correct:"correctAnswer",wrong:"wrongAnswer",noanswer:"noAnswer",unavailable:"unavailableAnswer"},main:function(){this.inputs=this.object.find('[name^="response"]').not(":disabled")},loadPreview:function(){this.main(),this.iterElements(this.loadPreviewItem),correctAnswers&&setTimeout($.proxy(function(){$.each(correctAnswers[this.id],$.proxy(this.addAlternativeAnswers,this))},this),0)},loadPreviewItem:function(e,t){},loadReport:function(){this.main(),this.iterElements(this.loadReportItem)},loadReportItem:function(e,t){var n,s,r,i=t.jThis,a=t.studentAnswer,o=t.corrects,d={};a.correct?(d={_hideOnly:!0,_answers:o,answer_type:"correctAnswer"},r=[{_class:i.classes.correct,_value:i.getHTMLValueForInput(e,t.studentAnswer.values[0].value)}],i.insertStudentAnswers(e,r,d)):void 0!==a.values&&0<a.values.length&&(""===a.values[0].value||a.values[0].value===e.data("predefinedcontent")?(d={_hideOnly:!0,_answers:o,answer_type:"noAnswer"},n=e.data("predefinedcontent")||"",s=o?i.getHTMLValueForInput(e,o[0]):n+Item.EMPTY_GAP,r=[{_class:i.classes.noanswer,_value:s}]):(d={_hideOnly:!0,_answers:o,answer_type:"wrongAnswer"},r=[{_class:i.classes.wrong,_value:i.getHTMLValueForInput(e,a.values[0].value)}],o&&r.unshift({_class:i.classes.unavailable,_value:i.getHTMLValueForInput(e,o[0])})),i.insertStudentAnswers(e,r,d))},loadSolve:function(){this.main(),this.iterElements(this.loadSolveItem)},loadSolveItem:function(e,t){var n=t.jThis;if(void 0!==t.studentAnswer.values&&t.studentAnswer.correct){var s,r={_hideOnly:!1,_clone:t.studentAnswer.values[0].value,answer_type:"correctAnswer"},i=n.getHTMLValueForInput(e,t.studentAnswer.values[0].value);s=[{_class:n.classes.correct,_value:i}],n.insertStudentAnswers(e,s,r),e.val(t.studentAnswer.values[0].value)}},getHTMLValueForInput:function(){},iterElements:function(r){var i=this;if("function"!=typeof r)throw"callback is not a function";this.inputs.each(function(e,t){var n=i.getResponseIdForInput(t),s=$(t);studentAnswer=i.getStudentAnswers(n),corrects=i.getCorrectResponses(n),args={studentAnswer:studentAnswer,corrects:corrects,jThis:this},r(s,args)}.bind(this))},checkFilledAnswers:function(){var n=!1;return this.object.find('[name^="response"]').each(function(e,t){""===$(t).val()&&(n=!0)}),!n},addAlternativeAnswers:function(e,t){var n=(e="string"==typeof e?$("#"+this.id+"-"+e):$(e)).position();if(t.length){var s="";$.each(t,function(e,t){s+="<li>"+t+"</li>"}),$("<div></div>",{class:"alternativeAnswerPreview",style:"position:absolute;width: "+e.outerWidth()+"px;height: "+e.outerHeight()+"px;top: "+n.top+"px;left: "+n.left+"px",html:'<div class="alternativeAnswersContent"><ul><b>'+ExposeTranslation.trans("correct.answer")+"</b>"+s+"</ul></div>"}).insertAfter(e)}}}),function(s,e,n){function t(e,t){n.call(this,e,t),this.constructor=arguments.callee}t.prototype=s.extend(e.getInstance(),{init:function(){var e="preview"===window.viewMode?"input[type=text]":"[disabled][type=text]";this.object.find(e).width(1),this.object.find("input").each(function(e,t){(t=s(t)).autoResize({comfortZone:5,minWidth:t.width(),maxWidth:t.parents("li.item").width()})})},loadPreviewItem:function(e,t){e.val(t.corrects[0]).attr("readonly",!0)},prepareToSend:function(){this.inputs=this.object.find('[name^="response"]').not(":disabled"),this.inputs.each(function(e,t){t=s(t);var n=s.trim(s(t).val());t.val(n)})},getHTMLValueForInput:function(e,t){return t}}),window.FillinItem=t}($,ValueItem,Item),FirstLetterItem.prototype=$.extend(FillinItem.getInstance(),{disabledPredefinedContent:function(){this.object.delegate('input:not([readonly="readonly"],:disabled)',"keydown",function(n){var s=$(this);setTimeout(function(){var e=s.data("predefinedcontent"),t=e.length;s.val().substring(0,t)!==e&&(s.val(e),n.returnValue=!1)},20)})},init:function(){FillinItem.getInstance().init.call(this),this.disabledPredefinedContent()},checkFilledAnswers:function(){return!!this.object.parent().hasClass("itemExample")||!this.object.find('[name^="response"]').filter(function(){return $(this).val()==$(this).data("predefinedcontent")}).length}}),FillinTableItem.prototype=$.extend(FirstLetterItem.getInstance(),{init:function(){var e="preview"===window.viewMode?"input[type=text]":"[disabled][type=text]";this.object.find(e).width(10),this.object.find("input").each(function(e,t){(t=$(t)).autoResize({comfortZone:5,minWidth:t.width(),maxWidth:t.parents(".fillin-table, .fillinTable").length?t.parents("td").width()-(t.outerWidth()-t.width()):t.parents("li.item").width()})})},checkFilledAnswers:function(){for(var e=this.object.find('[name^="response"]'),t=0;t<e.length;t++)if(""===e[t].value)return!1;return!0}}),ChoiceItem.prototype=$.extend(Item.getInstance(),{pattern:/^(.+)\[([a-zA-Z0-9_-]+)\]\[([a-zA-Z0-9_-]+)\]$/g,responseIdPattern:/\]\[(.*)\]$/,unavailableAnswerClass:"",getCorrectResponses:function(){return!1!==correctAnswers&&correctAnswers[this.id]},loadReport:function(){this.object.find("input:enabled").not(":hidden").each(function(e,t){this.pattern.compile(this.pattern);var n=this.pattern.exec($(t).attr("name"))[3];if(null!=n){if(0<this.getStudentAnswers(n).values.length){var s=this.getStudentAnswersValues(studentAnswers[this.id][n].values);arrayKeyExists($(t).attr("value"),s)?this.markAnswerAndClass(t,s[$(t).attr("value")]?"correctAnswer":"wrongAnswer"):correctAnswers&&inArray($(t).val(),this.getCorrectResponses()[n])&&this.markAnswerAndClass(t,this.unavailableAnswerClass)}else correctAnswers&&inArray($(t).val(),this.getCorrectResponses()[n])&&this.markAnswerAndClass(t,"noAnswer");$(t).attr("name",this.id+"_"+n+"_"+$(t).attr("value")),0==e&&this.setClassForItem(n)}$(t).attr("disabled",!0)}.bind(this)),this.spaceColumnsForFeedback()},spaceColumnsForFeedback:function(){var e,t=$(this.object).find(".buttonFeedback");t&&(e=$(this.object).width()-$(t).outerWidth(!0),$(this.object).find(".vertical, .horizontal").css({width:e}))},setClassForItem:function(e){},getStudentAnswersValues:function(e){var n=[];return $.each(e,function(e,t){n[t.value]=t.correct}.bind(n)),n},markAnswerAndClass:function(e,t){$(e).parent("label").addClass(t).append('<span class="answerIcon"></span>'),$(e).attr("checked",!0)},loadPreview:function(){var e=this.getCorrectResponses();for(key in e){var n=e[key];this.object.find(this.getResponseSelector(key)).each(function(e,t){inArray($(t).val(),n)&&$(t).attr("checked",!0),$(t).attr("disabled",!0)})}},addFeedbacks:function(){var e,t=this.object.find("input").not(":hidden").first();null!=(e=$(t).attr("name").match(this.responseIdPattern)[1])&&this.addFeedback(e)},addFeedback:function(e){var t=this.getStudentAnswers(e)||!1,n=t.feedback||[],r=t.correct?"specificCorrectFeedback":"specificWrongFeedback",i=this;$.each(n,function(e,t){var n=i.object.find('input[value="'+e+'"]'),s='<div class="buttonFeedback '+r+'"><div class="feedbackContent">'+t+"</div></div>";n.length?n.closest("label").append(s):(n=i.object.find("input:eq(0)")).closest(".itemContent").prepend(s)})},loadSolve:function(){this.object.find("input:enabled").not(":hidden").each(function(n,s){this.pattern.compile(this.pattern);var e=this.pattern.exec($(s).attr("name"))[3];if(null!=e){var t=this.getStudentAnswers(e);t&&t.correct&&($.each(t.values,function(e,t){t.value==$(s).attr("value")&&(this.markAnswerAndClass(s,"correctAnswer"),$("<input/>").val($(s).val()).attr("name",$(s).attr("name")).attr("type","hidden").insertAfter($(s)),0==n&&0==e&&(this.object.addClass("correctItem"),this.object.before('<span class="correctItem"></span>')))}.bind(this)),$(s).attr("disabled",!0))}}.bind(this))},insertResumedAnswer:function(e){if(!e.next().hasClass("correctAnswer")){var t=e.attr("name").match(this.responseIdPattern)[1],n=this.getResumedAnswers(t);n.values&&inArray({value:e.val()},n.values)&&e.attr("checked",!0)}},checkFilledAnswers:function(){return!!this.object.parent().hasClass("itemExample")||!!this.object.find('[name^="response"]:checked').length}}),function(e,t,n){function s(e,t){n.call(this,e,t),this.constructor=arguments.callee}s.prototype=n.extend(t,{pattern:/^(.+)\[([a-zA-Z0-9_-]+)\]\[([a-zA-Z0-9_-]+)\]\[\]$/g,responseIdPattern:/\]\[(.*)\]\[\]$/,unavailableAnswerClass:"noAnswer",getResponseSelector:function(e){return'input[name="response['+this.id+"]["+e+'][]"]'},setClassForItem:function(e){this.object.addClass(this.getStudentAnswers(e).correct?"correctItem":"wrongItem"),this.object.before('<span class="'+(this.getStudentAnswers(e).correct?"correctItem":"wrongItem")+'"></span>')},addFeedback:function(e){this._super.addFeedback.apply(this,arguments),this.object.find(".itemNumber:eq(0)").detach().prependTo(this.object)}}),window.MultipleChoiceItem=s}($,ChoiceItem,Item),SingleChoiceItem.prototype=Item.extend(ChoiceItem,{correctAnswerClass:"correctAnswer",loadSolve:function(){this.insertAnswers()},insertAnswers:function(){var e,t;if(e=this.getAnswer(),t=this,void 0===e)return!1;var n=Object.keys(e)[0],s=e[n];if(s&&s.correct){var r=s.values[0],i=t.getResponseSelector(n),a=t.object.find(i).attr("disabled","disabled").filter("[value="+r.value+"]");t.markAnswerAndClass(a,t.correctAnswerClass),t.object.addClass(t.correctItemClass)}},addFeedback:function(e){this._super.addFeedback.apply(this,arguments),this.object.find(".itemNumber:eq(0)").detach().prependTo(this.object)},markAnswerAndClass:function(e,t){var n=$(e);this._super.markAnswerAndClass(n,t),$("<input/>").val(n.val()).attr("name",n.attr("name")).attr("type","hidden").insertBefore(n),n.attr("disabled",!0)},getAnswer:function(){return studentAnswers[this.id]},pattern:/^(.+)\[([a-zA-Z0-9_-]+)\]\[([a-zA-Z0-9_-]+)\]$/g,unavailableAnswerClass:"unavailableAnswer",correctItemClass:"correctItem",getResponseSelector:function(e){return'input[name="response['+this.id+"]["+e+']"]'}}),AudiosubmitItem.prototype=$.extend(Item.getInstance(),{init:function(){AudiosubmitItem.initialized||(AudiosubmitItem.initialized=!0,AudiosubmitItem.init())},getAudioSubmitNote:function(e){var t=!1;return studentAnswers[this.id].audioSubmitNote&&(t=studentAnswers[this.id].audioSubmitNote),t},getTeacherComment:function(){var e=!1;return studentAnswers.studentAttemptComments&&(e=studentAnswers.studentAttemptComments),e},loadReport:function(){var e,t,o=this;this.object.find(".learnosity-response").css("height","auto"),this.object.find('[name^="response['+this.id+']"]').each(function(e,t){var n,s,r,i=$(t).attr("name").match(/response\[.*\]\[(.*)\]/)[1],a=$(t).attr("name");s=o.object.find('input[name="'+a+'"]'),Item.inTeacherGradedActivityWithModelAnswer()||(r=o.getAudioSubmitNote(i))&&(n=$("<div>").addClass("teacherNote").append($('<span class="note">'+ExposeTranslation.trans("assignment.teacher.note")+"</span>")).append($('<span class="note-text"></span>').html(r.replace(/\n/g,"<br />"))),s.after(n))}),t=this.getTeacherComment(),!Item.inTeacherGradedActivityWithModelAnswer()&&t&&(e=$("<div>").addClass("teacherComment").append($("<div>",{class:"teacherCommentHeader",text:ExposeTranslation.trans("assignment.teacher.comment")})).append($("<span>",{text:t.replace(/\n/g,"<br />")})),0===$(".teacherComment").length&&this.object.parents(".taskContent").siblings(".taskHeader").after(e)),this.adjustItemPositionInReport()},loadResumedAnswers:function(){resumedAnswers&&(learnosityActivityData.state="resume")},addFeedback:function(e){var t=this.getFeedback(e),n=this.object.find('[name="response['+this.id+"]["+e+']"]');t&&(t=$("<div>").addClass("teacherNote modelAnswer hidden").append($('<span class="note">'+ExposeTranslation.trans("model.answer")+"</span>")).append(t.replace(/\n/g,"")),n.after(t))},getFeedback:function(e){var t=this.getStudentAnswers(e)||!1;return!!(t&&t.feedback&&t.feedback[0])&&t.feedback[0]},adjustItemPositionInReport:function(){var e,t,n,s=this,r=0,i=s.object.parent(".item");e=setInterval(function(){i.is(":visible")&&AudiosubmitItem.isInitialised()&&(t=parseInt(s.object.parents(".taskContent").height()),s.object.parent(".item").prevUntil().each(function(){var e=$(this);n=e.find(".teacherNote").outerHeight(),r+=n}),i.css({position:"absolute",height:"auto",left:i.css("left"),top:parseInt(i.css("top"),10)+r}),t+=i.find(".teacherNote").outerHeight(),s.object.parents(".taskContent").height(t),clearInterval(e))},200)},prepareToSend:function(e,t){return AudiosubmitItem.iteration==e||(AudiosubmitItem.iteration=e,AudiosubmitItem.prepareToSend(t))}}),$.extend(AudiosubmitItem,{initObject:void 0,storedTemplates:[],init:function(e){var t,n,s=this,r=AudiosubmitItem.getLearnosityData();void 0===e&&(e=this.options),this.initObject&&AudiosubmitItem.stopPlayer(),this.storedTemplates=[],r.questions=$(".learnosity-response").toArray().map(function(e){return(n=$(e).data("learnosity")).learnosity_id?n.response_id=n.learnosity_id:n.response_id=AudiosubmitItem.getAttemptId()+"-"+AudiosubmitItem.getAttemptTimestamp()+"-"+n.response_id,s.storedTemplates.push(n),$(e).addClass("question-"+n.response_id),""!==$(e).data("begin")&&$(e).parent().addClass("begin"),n}),(0<(t=$(".learnosity-feature").toArray()).length||void 0===r.features)&&(r.features=t.map(function(e){return(n=$(e).data("learnosity"))&&$(e).addClass("feature-"+n.feature_id),n})),"evaluate"==viewMode&&(r.state="review"),r.features.length&&!r.questions.length&&(delete r.questions,delete r.state,delete r.type),this.initObject=LearnosityApp.init(r,e),player.settings&&setInterval(function(){$(".lrn_pause_sml:visible").length&&player.logUserActivity()},player.settings.timeToIdleness/2)},initWithResume:function(){LearnosityApp.reset(),this.clearWidgets(),learnosityActivityData.state="resume",this.init(this.options)},getLearnosityData:function(){return learnosityActivityData},clearWidgets:function(){var n,s;$.each(this.storedTemplates,function(e,t){t.learnosity_id=t.response_id,n=$("#"+t.learnosity_id),(s=$('<span class="learnosity-response"></span>')).data("learnosity",t),n.parent().append(s),n.remove()})},stopPlayer:function(){var t=AudiosubmitItem.getAllQuestions(),n=AudiosubmitItem.getAllFeatures();Object.keys(t).forEach(function(e){t[e].stop()}),Object.keys(n).forEach(function(e){n[e].stop()})},options:{errorListener:function(e){player.settings.onError&&(10002===e.code?AudiosubmitItem.initWithResume():player.settings.onError(e))},readyListener:function(){if(AudiosubmitItem.audiosubmitTranscript(),"evaluate"==viewMode){var s,e=learnosityActivityData.questions,r=$(".audiobuttons").children();if($("div.lrn_userinput").length)s="div.lrn_userinput";else{if(!$("div.lrn_response").length)throw'Missing "add note" button\'s container!';s="div.lrn_response"}e.forEach(function(e,t){var n=$("#"+e.response_id).find(s);n.addClass("audiobuttons"),n.append(r[t]),$("#item-"+$(r[t]).attr("id")).remove()})}},customUnload:function(){return null},errors:{10001:ExposeTranslation.trans("audio.format.error"),10002:ExposeTranslation.trans("audio.response.id.conflict"),10003:ExposeTranslation.trans("audio.failed.authentication"),10004:ExposeTranslation.trans("audio.save.responses.failed"),10005:ExposeTranslation.trans("audio.response.not.found"),10006:ExposeTranslation.trans("audio.save.to.sever.failed"),10008:ExposeTranslation.trans("audio.asset.not.found"),10009:ExposeTranslation.trans("audio.asset.temporarily.not.available"),10010:ExposeTranslation.trans("audio.asset.expired"),10011:ExposeTranslation.trans("flash.required.for.activity"),10012:ExposeTranslation.trans("audio.no.microphone.found"),10013:ExposeTranslation.trans("audio.question.validation.failed"),10014:ExposeTranslation.trans("audio.asset.format.not.supported"),10015:ExposeTranslation.trans("audio.browser.not.supported"),10016:ExposeTranslation.trans("audio.failed.capturing.questions")},labelBundle:{loadingInfo:ExposeTranslation.trans("audio.loadingInfo"),listen:ExposeTranslation.trans("audio.listen"),record:ExposeTranslation.trans("audio.record"),recording:ExposeTranslation.trans("audio.recording"),playback:ExposeTranslation.trans("audio.playback"),stop:ExposeTranslation.trans("audio.stop"),pause:ExposeTranslation.trans("audio.pause"),continuelabel:ExposeTranslation.trans("audio.continuelabel"),loading:ExposeTranslation.trans("status.loading"),error:ExposeTranslation.trans("audio.error"),seekTo:ExposeTranslation.trans("audio.seekTo"),downloadAudio:ExposeTranslation.trans("audio.downloadAudio"),rightClickAudioDownload:ExposeTranslation.trans("audio.rightClickAudioDownload"),recordAuthRememberLine1:ExposeTranslation.trans("audio.recordAuthRememberLine1"),recordAuthRememberLine2:ExposeTranslation.trans("audio.recordAuthRememberLine2"),recordAudioStatusTitle:ExposeTranslation.trans("audio.recordAudioStatusTitle"),recordAudioStatusLine:ExposeTranslation.trans("audio.recordAudioStatusLine"),onbeforeunload:ExposeTranslation.trans("audio.onbeforeunload"),confirmrecordoverwrite:ExposeTranslation.trans("audio.confirmrecordoverwrite"),audioplaybackerror:ExposeTranslation.trans("audio.audioplaybackerror"),uierrorfeedback:ExposeTranslation.trans("audio.uierrorfeedback"),audioretrievalretry:ExposeTranslation.trans("audio.audioretrievalretry"),retry:ExposeTranslation.trans("audio.retry"),checkAnswer:ExposeTranslation.trans("audio.checkAnswer"),correctAnswer:ExposeTranslation.trans("audio.correctAnswer"),saveButtonLabel:ExposeTranslation.trans("audio.saveButtonLabel"),saveInProgress:ExposeTranslation.trans("audio.saveInProgress"),saveComplete:ExposeTranslation.trans("audio.saveComplete"),submitButtonLabel:ExposeTranslation.trans("audio.submitButtonLabel"),submitInProgress:ExposeTranslation.trans("audio.submitInProgress"),submitComplete:ExposeTranslation.trans("audio.submitComplete"),reset:ExposeTranslation.trans("audio.reset"),replay:ExposeTranslation.trans("audio.replay"),unavailable:ExposeTranslation.trans("audio.unavailable"),recordingUnavailable:ExposeTranslation.trans("audio.recordingUnavailable"),playbackUnavailable:ExposeTranslation.trans("audio.playbackUnavailable")}},setDisplayChangeListeners:function(e,t,n,s){e.addEventListener(t,function(){s.style.display=n})},audiosubmitTranscript:function(){var e=document.querySelectorAll(".lrn_transcript_wrapper"),a=document.querySelectorAll(".lrn_transcript_wrapper .lrn_transcript_content"),o=document.querySelectorAll(".lrn_transcript_wrapper .lrn_transcript");e.forEach(function(e,t){var n=e.parentElement,s=o[t],r=a[t];if(s&&r){var i=document.createElement("div");i.classList.add("transcript"),i.innerHTML=r.dataset.text,r.remove(),n.appendChild(i),AudiosubmitItem.setDisplayChangeListeners(s,"mouseenter","block",i),AudiosubmitItem.setDisplayChangeListeners(s,"mouseleave","none",i),AudiosubmitItem.setDisplayChangeListeners(s,"focus","block",i),AudiosubmitItem.setDisplayChangeListeners(s,"focusout","none",i),AudiosubmitItem.setDisplayChangeListeners(i,"mouseenter","block",i),AudiosubmitItem.setDisplayChangeListeners(i,"mouseleave","none",i)}})},getAttemptId:function(){return $("input.attemptId").val()||"rand"+Math.floor(1e7*Math.random())},getAttemptTimestamp:function(){return $("input.attemptTimestamp").val()||"rand"+Math.floor(1e7*Math.random())},getAllQuestions:function(){return AudiosubmitItem.initObject.questions()},getAllFeatures:function(){return AudiosubmitItem.initObject.features()},prepareToSend:function(e){return LearnosityApp.save(e),"wait"},isInitialised:function(){return void 0!==this.initObject}});var errors=[];function EssayItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function DropDownItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function InlineDropDownItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function DragAndDropItem(e,t){Item.call(this,e,t),this.usedResponses=[],this.constructor=arguments.callee}function CategorisationDragAndDropItem(e,t){Item.call(this,e,t),this.usedResponses=[],this.constructor=arguments.callee}function SingleUnderlineItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function PositionalDragAndDropItem(e,t){Item.call(this,e,t),this.usedResponses=[],this.constructor=arguments.callee}function DraggableJumbledWordsItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function MatchingItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function HangmanItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function Square(e,t){function n(e,t){e&&(e.example?e.moveFunctions[t](e):(e.input.focus().select(),(e.phrase.crosswordItem.currentSquare=e).phrase.crosswordItem.currentPhrase=e.phrase))}this.phrase=e,this.input=t,this.example=t.hasClass("example"),this.move=function(e,t){if(!(this.input.data("direction").indexOf(e)+1))return!1;if(this.phrase.hiddenInput.data("direction").indexOf(e)+1)this.moveFunctions[t](this);else{var n=this.phrase.crosswordItem,s=n.getResponseIdsArray(this.input,this.phrase.responseId);n.getPhrase(s,!0).getSquareByInput(this.input).move(e,t)}},this.moveFunctions={left:function(e){n(e.prev,"left")},right:function(e){n(e.next,"right")},up:function(e){n(e.prev,"up")},down:function(e){n(e.next,"down")}}}function Phrase(e,t,n){this.squares=[],this.hiddenInput=e,this.responseId=t,this.crosswordItem=n}function Component(){this.prev=null,this.next=null}function CrosswordItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function WordsearchItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function InsertAWordItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function PSEAudiosubmitItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function ReorderItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function RecallAPassageItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function ShortWritingItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function DictationItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}function ErrorCorrectionItem(e,t){Item.call(this,e,t),this.constructor=arguments.callee}EssayItem.prototype=$.extend(Item.getInstance(),{disable:!1,options:{refreshTimeInterval:500,timerRedTimeInSec:31,warmRedTimeInSec:6,wordSelector:"word-count",timerSelector:"time-count",warningColor:"rgb(255, 0, 0)",normalColor:"rgb(0, 0, 0)",noTimeValue:"0:00"},timerElement:null,wordCountElement:null,getResponseIdForInput:function(e){return $(e).attr("id").substr(this.id.length+1)},prepareToSend:function(){var e=this.object.find("textarea.timedObject").attr("disabled");void 0!==e&&!1!==e&&(this.disable=!0,this.object.find("textarea.timedObject").removeAttr("disabled"))},afterPrepareToSend:function(){this.disable&&(this.object.find("textarea.timedObject").attr("disabled","disabled"),this.disable=!1)},prepareAnswer:function(){for(var e=this.object.find(".answer"),t=e.html().replace(/<br>/g,"↵"),n="",s=0;s<t.length;s++)n+='<span class="answer-character" id="character-'+s+'">'+t[s]+"</span>";e.html(n.replace(/↵/g,"<br />"))},loadPreview:function(){this.object.find('textarea[name^="response"]').attr("readonly",!0)},setTimers:function(s,r){"use strict";require(["platform/Activities/state/construct/state","platform/Activities/state/model/state","platform/Activities/timer"],function(e,t,n){e.setModel(t),s.startTime?new n(r,{time:s.startTime,autostart:!0,emitEvents:!1,destroyable:!0,onStart:function(){r.attr("disabled","disabled").trigger("keyup"),e.setActivityState("START"),s.solveTime&&new n(r,{time:s.solveTime+s.startTime,autostart:!0,emitEvents:!1,destroyable:!0,onStop:function(){r.attr("disabled","disabled"),player.save({disableMessage:!0})}})},onStop:function(){r.removeAttr("disabled")}}):s.solveTime&&new n(r,{time:s.solveTime,autostart:!0,emitEvents:!1,destroyable:!0,onStart:function(){e.setActivityState("START"),r.trigger("keyup")},onStop:function(){r.attr("disabled","disabled"),player.save({disableMessage:!0})}})})},loadSolve:function(){var e;if(window.viewMode=window.viewMode||"solve",window.viewData.isGse){this.addWordCount();var t=this.object.find('textarea[name^="response"]');(e=t.data("timers"))&&(this.setInitialTimers(),this.setTimers(e,t),this.addVisualTimer(e)),t.on("paste",function(e){e.preventDefault()}),requirejs(["can","platform/Activities/timer"],function(n,s){n.$(".referenceObject.timedObject").each(function(e,t){new s(n.$(t),{time:n.$(t).data("timers").solveTime,autostart:!0,emitEvents:!1,destroyable:!0,callback:{func:function(e){e.css("color","red")},executeTime:24e3},onStart:function(e){e.addClass("preventCopying"),e.on("mousedown",function(){return!1}),e.on("mousedown",function(){return!1}),e.show()},onStop:function(e){e.fadeOut(0)}})})})}},loadReport:function(){var s,e,t=this.object.find("textarea"),n=this.getResponseIdForInput(t),r=this.getStudentAnswers(n),i=r.values.length?r.values[0].value:"",a=$("html").hasClass("lt-ie9")?"<BR>":"<br>",o=i.replace(/\r\n/g,a),d=$("<div>").addClass("answer essayReport").attr("style",t.attr("style")).html(o);t.after(d),t.remove(),this.prepareAnswer(),Item.inTeacherGradedActivityWithModelAnswer()||(ErrorDecorator.prototype.findLineBreaks(null,o),null!=studentAnswers.studentAttemptComments&&((e=$("<div>",{class:"teacherComment"})).append($("<div>",{class:"teacherCommentHeader",text:"Teacher comment"})).append($("<span>",{text:studentAnswers.studentAttemptComments})),this.object.parents(".taskContent").siblings(".taskHeader").after(e)),s={wrapperId:"#item"+this.id+" "},void 0!==r.categoriesErrors&&$.each(r.categoriesErrors,function(e,n){$.each(n,function(e,t){"classCss"===e&&(categoryCssClass=t),"errors"===e&&$.each(t,function(e,t){t.category=Translator.trans(n.name),errors.push(t),new ErrorDecorator(t,categoryCssClass,s)})})}),0===$(".noteContent").length&&$("<div class='noteContent'><h3></h3><span></span></div>").insertAfter(d))},insertResumedAnswer:function(e){if(!e.next().hasClass("correctAnswer")){var t=this.getResumedAnswers(this.getResponseIdForInput(e));if(t.values&&t.values[0]){var n=t.values[0].value;e.html(n)}}},addFeedback:function(e){var t,n=this.getFeedback(e);n instanceof Array&&(t=n[0]),n&&(n=$("<div>",{class:"teacherNote modelAnswer hidden"}).append($('<span class="note">'+Translator.trans("model.answer")+"</span>")).append($('<div class="modelAnswerContent">'+t.replace(/\n/g,"<br/>")+"</div>")),this.object.append(n))},getFeedback:function(e){var t=this.getStudentAnswers(e)||!1;return!(!t||!t.feedback)&&t.feedback},checkFilledAnswers:function(){var n=!1;return this.object.find('[name^="response"]').each(function(e,t){""==$(t).val()&&(n=!0)}),!n},addDOMelements:function(e){return this.object.append('<div class="'+e.divClass+'">'+e.translation+' <span class="'+e.spanClass+'">'+e.defaultValue+"</span></div>")},addWordCount:function(){this.wordCountElement||(this.wordCountElement=this.addDOMelements({divClass:"div-"+this.options.wordSelector,translation:Translator.trans("word.count"),spanClass:this.options.wordSelector,defaultValue:"0"}));var t=this.object.find("span.word-count"),n=this.object.find('textarea[name^="response"]');n.on("keyup",$.proxy(function(){var e=$.trim(n.val());0<e.length?(e=e.split(/\s+/),t.html(e.length)):t.html(0)},this)),n.on("paste",$.proxy(function(){setTimeout(function(){n.trigger("keyup")},0)},this))},setInitialTimers:function(){this.timers={timeLeft:0,warmTime:0,timeLeftTS:null,warmTS:null}},addVisualTimer:function(e){this.timerElement||(this.timerElement=this.addDOMelements({divClass:"div-"+this.options.timerSelector,translation:Translator.trans("time.left"),spanClass:this.options.timerSelector,defaultValue:this.options.noTimeValue})),this.timers.timeLeftTS=Date.now()+e.solveTime,e.startTime&&(this.timers.warmTS=Date.now()+e.startTime,this.timers.warmTime=this.timers.warmTS-Date.now(),this.timers.timeLeftTS=Date.now()+(e.solveTime+e.startTime)),this.timers.timeLeft=this.timers.timeLeftTS-Date.now(),this.refreshVisualTimer(),setInterval(this.syncTimers.bind(this),this.options.refreshTimeInterval)},setPropperColorForTimer:function(e){0<this.timers.warmTime?this.timers.warmTime<=1e3*this.options.warmRedTimeInSec?e.style.color=this.options.warningColor:e.style.color=this.options.normalColor:this.timers.timeLeft<=1e3*this.options.timerRedTimeInSec?e.style.color=this.options.warningColor:e.style.color=this.options.normalColor},formatTimeWithLeadingZero:function(e){return e/=1e3,Math.floor(e/60)+":"+("0"+Math.floor(e%60)).slice(-2)},recalculateTime:function(){var e=player.timeLeft;0<this.timers.warmTime&&e<this.timers.warmTime?this.timers.warmTS=Date.now()+e:e<this.timers.timeLeft&&(this.timers.timeLeftTS=Date.now()+e)},refreshVisualTimer:function(){var e,t,n=this.object.find("."+this.options.timerSelector)[0];this.setPropperColorForTimer(n),t=0<(e=this.timers.warmTime||this.timers.timeLeft)?this.formatTimeWithLeadingZero(e):this.options.noTimeValue,n.innerHTML=t},syncTimers:function(){var e=Date.now();0<this.timers.warmTime&&this.timers.warmTS>e?this.timers.warmTime=this.timers.warmTS-e:this.timers.warmTime=0,0<this.timers.timeLeft&&this.timers.timeLeftTS>e?this.timers.timeLeft=this.timers.timeLeftTS-e:this.timers.timeLeft=0,this.recalculateTime(),this.refreshVisualTimer()}}),DropDownItem.prototype=$.extend(ValueItem.getInstance(),{loadPreviewItem:function(e,t){e.val(t.corrects[0]),e.find("option").attr("disabled",!0)},addAlternativeAnswers:function(){},getHTMLValueForInput:function(e,t){return e.find('option[value="'+t+'"]').html()},onReport:function(){this.loadReport(),this.addFeedbacks()},addFeedback:function(e){var t,n,s=this.getStudentAnswers(e)||!1;s&&"string"==typeof(t=this.getFeedbackValue(s))&&t.length&&(n=s.correct?"specificCorrectFeedback":"specificWrongFeedback",this.object.find('[name="response['+this.id+"]["+e+']"]').next().after('<div class="buttonFeedback '+n+'"><div class="feedbackContent">'+t+"</div></div>"))}}),InlineDropDownItem.prototype=$.extend(DropDownItem.prototype,{}),DragAndDropItem.prototype=$.extend(Item.getInstance(),{emptyGap:"_____",zIndexClassForDragsWrappers:".drop",cssRefreshObj:{"min-width":"120px","min-height":"26px","border-color":"#cbcbcb","background-color":"#fff","background-position":"center -185px"},cssRefreshWithChildren:{"border-color":"transparent","background-color":"transparent","background-position":"center 100px"},getResponseIdForInput:function(e){return $(e).attr("id").substr(this.id.length)},prepareToSend:function(){this.object.find('input[name^="response"]').each(function(){var e=$(this).prev().find(".drag").data("id");e?$(this).val(e):$(this).prev().hasClass("correctAnswer")||$(this).val("")})},setWidthForExampleElement:function(e,t){e.css("min-width",t)},renderExamples:function(){var s=this;this.object.find(".example").each(function(){var e=$(this),t=e.attr("example-id"),n=s.object.find('div.drag[data-id="'+t+'"]:not(.example):first').addClass("example").addClass("disabled").draggable("option","disabled",!0);n=n.clone(),s.setWidthForExampleElement(e,n.css("width")),e.append(n).droppable("option","disabled",!0).css("min-height",n.css("height")),e.children(".drag").css("min-width","inherit")})},getTypeClass:function(e){return null==e?null:$(e).find(".itemAsset").length?"asset":"text"},loadPreview:function(){this.renderExamples();var r=this;r.object.addClass("preview"),r.object.find("div.drop").not(".example").each(function(){var e=$(this),t=e.attr("id").substr(r.id.length),n=r.getCorrectResponses(t),s=null;$.each(n,function(e,t){null!=s&&0<s.length||(s=r.object.find('.wordpoolWrapper div[data-id="'+t+'"]').not(".disabled").first())}),null!=s&&0!=s.length&&(e.append(s),r.setMinWidth(e))}),r.refreshGapSize(),r.setTopForDroppableArea()},setMinWidth:function(e){var t=e.children();t&&e.css("min-width",t.first().width())},loadSolve:function(){var a=this;"object"===("undefined"==typeof studentAnswers?"undefined":_typeof(studentAnswers))&&this.object.find("div.drop").not(".example").each(function(e,t){var n=$(this).attr("id").substr(a.id.length),s=a.getStudentAnswers(n).values[0];if(s&&s.correct){var r=a.object.find('div.drag[data-id="'+s.value+'"]:first'),i=r.html();r.remove(),a.insertStudentAnswers($(t),[{_class:"correctAnswer",_value:i,_typeClass:a.getTypeClass(r)}],{answer_type:"correctAnswer"}),a.object.find('input[name="response['+a.id+"]["+n+']"]').val(s.value)}}),a.renderExamples(),a.setTopForDroppableArea()},insertResumedAnswer:function(e){if(!e.prev().hasClass("correctAnswer")){var t=e.prev(),n=this.getResumedAnswers(this.getResponseIdForInput(t));if(n&&n.values){answerValue=n.values[0].value;var s=this.object.find('div.drag[data-id="'+answerValue+'"]').not(".example").first();e.val(answerValue),s.appendTo(t),t.css({"min-width":s.width(),"min-height":s.height()})}}this.refreshGapSize()},refreshGapSize:function(){var t=this;this.object.find(".drop").each(function(){var e=function(e,t){Object.assign(t.style,e)};0===this.children.length?e(t.cssRefreshObj,this):e(t.cssRefreshWithChildren,this)})},revertSiblings:function(e){this.object.find(".wordpoolWrapper")[0].appendChild(e)},init:function(){var o,e,i=this,d=this;if(o=d.object.find(".wordpoolWrapper"),e={axis:"y",containment:d.object.parent(".item"),handle:".wordpoolMove",drag:function(e,t){var n=d.object.parent(".item").height()-o.height(),s=parseInt(o.css("margin-bottom")),r=parseInt(o.css("padding-bottom")),i=parseInt(o.css("padding-top")),a=n-s-i-r;t.position.top>a?t.position.top=a:t.position.top<0&&(t.position.top=0)}},o.draggable(e).css("width",d.object.closest(".item").width()-20),d.object.parent().addTouch(),"solve"===viewMode){var t={dndElement:this.object[0],targetsSelector:"div.drop:not(.example)",wordpoolSelector:"div.wordpoolWrapper",itemsSelector:"div.drag:not(.disabled)",wordpoolItemsSelector:["div.drag.example.disabled","div.wordpoolMove"],backgroundColor:"#fffad7",stateActiveClass:"ui-state-active",styleOpactityValue:.5,afterDropCallback:function(e){var t=e.selectedObject,n=e.isEscKey,s=e.dropTarget;if(i.refreshGapSize(),!n){s.style.minWidth=t.clientWidth+"px";var r=t.previousElementSibling;r&&i.revertSiblings(r)}}};new DragAndDropPlugin(t),ActivityPlatformService.isProgressOrPlacement()||function(e){var t=e.closest(".task");if(!t.querySelectorAll(".instruction").length){var n=new InstructionComponent({instruction:"dnd-general"});t.querySelector(".taskHeader").appendChild(n.getElement())}}(this.object[0])}},getCorrect:function(e){var t,n;return t=this.getCorrectResponses(e),$(t).each($.proxy(function(e){return n=t[e],-1!==$.inArray(n,this.usedResponses)||(this.usedResponses.push(n),!1)},this)),n},loadReport:function(){this.renderExamples();var o=$(this.object.find(".wordpoolWrapper > .drag"));o.css("zIndex",10);var d=this;d.object.find(".wordpoolMove").hide();var t=function(e,t,n){var s,r,i,a=t.prev();return!a.hasClass("drop")||(s=d.getResponseIdForInput(a),r=d.getStudentAnswers(s),n&&!1===r.correct||(n||!0!==r.correct)&&(i=d.getCorrect(s,r),r&&d.insertStudentAnswers(t.prev(),d.getAnswerElements(o,i,r),{_answers:d.getCorrectAnswerTexts(s),answer_type:d.getAnswerClass(r)})),!0)},e=d.object.find('input[name^="response"]');e.each(function(e){t(0,$(this),!0)}),e.each(function(e){t(0,$(this),!1)}),d.setTopForDroppableArea()},getElement:function(e,t,n){return t?e.filter('[data-id="'+t+'"]'):n.values[0].value.length?e.filter('[data-id="'+n.values[0].value+'"]'):null},getCorrectText:function(e){return null==e?this.emptyGap:e.html()},getStudentText:function(e,t){var n=e.filter('[data-id="'+t.values[0].value+'"]').html();return void 0===n&&(n=""),n},getAnswerClass:function(e){return 0==e.values[0].value.length?"noAnswer":e.correct?"correctAnswer":"wrongAnswer"},getAnswerElements:function(e,t,n){var s=this.getElement(e,t,n),r=this.getCorrectText(s),i=this.getAnswerClass(n),a=[];return"wrongAnswer"===i?(t&&a.push({_class:"unavailableAnswer",_value:r}),a.push({_class:"wrongAnswer",_value:this.getStudentText(e,n)})):a.push({_class:i,_value:r}),a},getCorrectAnswerTexts:function(e){var t=this.getCorrectResponses(e),n=this;return!!t&&t.map(function(e){return n.object.find('.drag[data-id="'+e+'"]').html()})},addAlternativeAnswers:function(e,t){var n;return e instanceof jQuery||(e=$(e)),!!t.length&&(n="<li>"+this._getUniqueList(t).join("</li><li>")+"</li>",e.append('<div class="alternativeAnswersContent"><ul><b>'+ExposeTranslation.trans("correct.answer")+"</b>"+n+"</ul></div>"),e)},_getUniqueList:function(e){var n=[];return $.each(e,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),n},checkFilledAnswers:function(){return!this.object.find(".drop:not(.example)").filter(function(){return!$(this).find(".drag").length}).length},setTopForDroppableArea:function(){}}),CategorisationDragAndDropItem.prototype=$.extend(DragAndDropItem.getInstance(),{prepareToSend:function(){this.object.find('.drag input[name^="response"]').each(function(){var e,t=$(this),n=t.parents(".boxBody");n.length?(e=n.data("id")+" "+t.parent().data("id"),t.val(e).attr("disabled",!1)):t.attr("disabled",!0)})},renderExamples:function(){var r=this;this.object.find(".example").each(function(){var e=$(this).attr("example-id"),t=r.object.find('div.categorisationBox div[data-id="'+e+'"]'),n=$(this).clone(),s=$("<span>",{class:"example",text:"(Example)"});n.append(s),t.append(n)})},loadSolve:function(){if("object"===("undefined"==typeof studentAnswers?"undefined":_typeof(studentAnswers)))for(var e,t,n,s,r,i=this.object.find("div.drag").first().find("input").attr("name").match(/\]\[(.*)\]\[/)[1],a=this.getStudentAnswers(i).values,o=a?a.length:0,d=0;d<o;d++)(e=this.getStudentAnswers(i).values[d]).correct&&(t=e.value.substr(0,e.value.indexOf(" ")),n=e.value.substr(e.value.indexOf(" ")+1),r=(s=this.object.find('div.drag[data-id="'+n+'"]').not("example").first()).closest(".itemContent").find('div.categorisationBox div[data-id="'+t+'"]'),s.addClass("correctAnswer"),s.draggable("option","disabled",!0),r.append(s));this.renderExamples()},refreshCategorisationBoxClass:function(){var e=this.object[0].querySelectorAll(".categorisationBox"),t=!0,n=!1,s=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=r.value;0===a.querySelector(".boxBody").childNodes.length?a.classList.add("empty"):a.classList.remove("empty")}}catch(e){n=!0,s=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw s}}},insertResumedAnswer:function(e){for(var t=$(e).parent(),n=t.data("id"),s=t.find("input").attr("name").match(/\]\[(.*)\]\[/)[1],r=this.getResumedAnswers(s),i=r.values,a=i?i.length:0,o=0;o<a;o++){var d,c=r.values[o].value,l=c.substr(0,c.indexOf(" "));n===c.substr(c.indexOf(" ")+1)&&(d=t.closest(".itemContent").find('div.categorisationBox div[data-id="'+l+'"]'),t.hasClass("example")||d.append(t))}},init:function(){var o,e,d=this,c=this;if(o=c.object.find(".wordpoolWrapper"),e={axis:"y",containment:c.object.parent(".item"),handle:".wordpoolMove",drag:function(e,t){var n=c.object.parent(".item").height()-o.height(),s=parseInt(o.css("margin-bottom")),r=parseInt(o.css("padding-bottom")),i=parseInt(o.css("padding-top")),a=n-s-i-r;t.position.top>a?t.position.top=a:t.position.top<0&&(t.position.top=0)}},o.draggable(e).css("width",c.object.closest(".item").width()-20),c.object.parent().addTouch(),this.refreshCategorisationBoxClass(),"solve"===viewMode){var t={dndElement:this.object[0],targetsSelector:"div.boxBody",wordpoolSelector:"div.wordpoolWrapper",itemsSelector:"div.drag:not(.example):not(.correctAnswer)",wordpoolItemsSelector:["div.drag.example","div.wordpoolMove","div.drag.correctAnswer"],backgroundColor:"#fffad7",stateActiveClass:"ui-state-active",styleOpactityValue:.5,afterDropCallback:function(e){var t=e.targets,n=!0,s=!1,r=void 0;try{for(var i,a=t[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){i.value.style.backgroundColor=""}}catch(e){s=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(s)throw r}}d.refreshCategorisationBoxClass()}};new DragAndDropPlugin(t),ActivityPlatformService.isProgressOrPlacement()||function(e){var t=e.closest(".task");if(!t.querySelectorAll(".instruction").length){var n=new InstructionComponent({instruction:"dnd-general"});t.querySelector(".taskHeader").appendChild(n.getElement())}}(this.object[0])}},loadPreview:function(){var e,t,i=this;this.object.addClass("preview"),"object"==("undefined"==typeof correctAnswers?"undefined":_typeof(correctAnswers))&&(e=i.object.find("div.drag:first").find("input").attr("name").match(/\]\[(.*)\]\[/)[1],t=i.getCorrectResponses(e),$.each(t,function(e,t){var n=t.split(" "),s=i.object.find('div.drag[data-id="'+n[1]+'"]').not(".example").eq(0),r=s.closest(".itemContent").find('div.categorisationBox div[data-id="'+n[0]+'"]');s.addClass("disabled").draggable("option","disabled",!0),s=s.clone(),r.append(s)})),this.renderExamples()},getCorrectGroupName:function(e,t){for(var n=$(t),s=correctAnswers[this.id][e],r=n.data("id"),i="",a=s.length,o=0;o<a;o++)s[o].split(" ")[1]===r&&(i=s[o].split(" ")[0]);return i},loadReport:function(){var e,t,n,s,r,i,a=this,o=this.object.find('input[name^="response"]:first')[0].name.match(/^.*\]\[(.*)\]\[.*\]$/)[1],d=this.getStudentAnswers(o).values;this.object.find(".hint").remove(),t=$(a.object.find(".droppableWrapper > .categorisationBox > .boxBody")),a.renderExamples(),a.object.find(".wordpoolMove").hide(),d&&this.moveElementsToCategories(d),r=$(a.object.find(".wordpoolWrapper > .drag")).not(".example").addClass("noAnswer"),i=$(a.object.find(".drag.wrongAnswer")).not(".example").addClass("wrongAnswer"),correctAnswers&&(t=a.object.find(".droppableWrapper > .categorisationBox > .boxBody"),a.object.find(".wordpoolWrapper").hide(),r.each(function(){e=a.getCorrectGroupName(o,this),t.filter('[data-id="'+e+'"]').append(this)}),i.each(function(){e=a.getCorrectGroupName(o,this),n="("+(n=t.filter('[data-id="'+e+'"]').siblings(".boxTitle").text())+")",s=$("<span>",{text:n,class:"categoryName"}),$(this).prepend(s)}))},moveElementsToCategories:function(e){for(var t=0,n=e.length;t<n;t++){var s,r,i,a,o=$(this.object.find(".wordpoolWrapper > .drag")).not(".example").addClass("disabled"),d=this.object.find(".droppableWrapper > .categorisationBox > .boxBody");a=e[t].value.split(" "),s=$(o.filter('[data-id="'+a[1]+'"]').first()),r=$(d.filter('[data-id="'+a[0]+'"]').first()),i=e[t].correct?"correctAnswer":"wrongAnswer",s&&r&&(s.addClass(i),r.append(s))}},checkFilledAnswers:function(){var e=this.object.find("[data-max-associations]").attr("data-max-associations")-1,t=this.object.find(".wordpoolWrapper .drag:not(.example)").length;return t<=this.object.find(".drag:not(.example)").length-e||0===t},addFeedbacks:function(){var e=this.object.find(".drag input:hidden").attr("name").match(/\]\[(.*)\]\[/)[1],i=this.getStudentAnswers(e)||!1,t=i.feedback||[],a=this;$.each(t,function(n,e){var t,s,r;(r=a.object.find("[data-id="+n+"]:not(.example)"))&&(s=(t=i.values.filter(function(e){var t=e.value.split(" ");return!!t[0]&&inArray(n,t)}))[0]&&t[0].correct?"specificCorrectFeedback":"specificWrongFeedback",r.prepend('<div class="buttonFeedback '+s+'"><div class="feedbackContent">'+e+"</div></div>"))})}}),function(a,n){function e(e,t){n.call(this,e,t),this.constructor=arguments.callee}e.prototype=a.extend(n.getInstance(),{loadSolve:function(){var i=this;this.object.find('input:hidden[name^="response"]').each(function(e,t){i.responseIdPattern.compile(i.responseIdPattern);var n=a(t),s=i.responseIdPattern.exec(n.attr("name"))[1];if(void 0!==s){var r=i.getStudentAnswers(s);r&&r.correct&&r.values&&inArray({value:n.val(),correct:!0},r.values)&&(n.prop("disabled",!1),n.parent().addClass("selected correctAnswer").parent().addClass("disabled"),i.object.data("correct",!0))}}),this.bindEvents()},init:function(){},bindEvents:function(){var t=this;this.object.find(".underlineGroup:not(.example, .disabled) .underlineElement:not(.correctAnswer)").click(function(){var e=a(this);e.hasClass("selected")?(e.removeClass("selected"),e.children(":input").attr("disabled",!0)):(t.deselectAll(e),e.addClass("selected"),e.hasClass("wrongAnswer")?(e.removeClass("selected wrongAnswer"),e.children(":input").prop("disabled",!0)):e.children(":input").prop("disabled",!1))}).addTouch()},deselectAll:function(e){},loadPreview:function(){var r=this;this.object.addClass("disabled"),this.object.find(".underlineGroup:not(.example) span.underlineElement:not(.example)").each(function(){var n=a(this),s=n.find("input").val(),e=n.parents(".underlineGroup").eq(0).attr("id").substr(r.id.length+1),t=r.getCorrectResponses(e);a(t).each(function(e,t){t==s&&n.addClass("correctAnswer")})})},getResponseIdForInput:function(e){return a(e).attr("name").match(this.responseIdPattern)[1]},loadResumedAnswers:function(){var e=this;resumedAnswers&&this.object.find('[name^="response"]').each(function(){e.insertResumedAnswer(a(this))})},insertResumedAnswer:function(e){if(!e.next().hasClass("correctAnswer")){var t=this.getResumedAnswers(this.getResponseIdForInput(e));t.values&&inArray({value:e.val()},t.values)&&(e.prop("disabled",!1),e.parent().addClass("selected"))}},getChoiseOptionContainer:function(e,t){return a("#"+this.id+"_"+e+"_"+t)},loadReport:function(){var r=this,e=studentAnswers[this.id];null!=e&&(correctAnswers?a.each(correctAnswers[this.id],function(s,e){var t=r.getStudentAnswers(s);if(null!=t&&0!=t)if(0==t.values.length){var n=r.getCorrectResponses(s);a.each(n,function(e,t){r.getChoiseOptionContainer(s,t).parent().addClass("noAnswer")})}else a.each(t.values,function(e,t){r.getChoiseOptionContainer(s,t.value).parent().addClass(t.correct?"correctAnswer":"wrongAnswer")}),a.each(e,function(e,t){var n=r.getChoiseOptionContainer(s,t).parent();n.is(":not(.wrongAnswer, .correctAnswer)")&&n.addClass("unavailableAnswer")})}):a.each(e,function(n,e){var s=a("#"+r.id+"_"+n);a.each(e.values,function(e,t){s.find("#"+r.id+"_"+n+"_"+t.value).parent().addClass(t.correct?"correctAnswer":"wrongAnswer")})}))},checkFilledAnswers:function(){return!!this.object.parent().hasClass("itemExample")||(!!this.object.data("correct")||!!this.object.find(".underlineElement.selected").length)},addFeedbacks:function(){var s=this;this.object.find(".underlineGroup").each(function(e,t){var n=a(t).attr("id").substr(s.id.length+1);this.addFeedback(n)}.bind(this))},addFeedback:function(s){var e=this.getStudentAnswers(s)||!1,t=e.feedback||[],r=e.correct?"specificCorrectFeedback":"specificWrongFeedback",i=this;a.each(t,function(e,t){var n=i.object.find('input[value="'+e+'"]');n.length?n.after('<div class="buttonFeedback '+r+'"><div class="feedbackContent">'+t+"</div></div>"):(n=i.object.find(".underlineGroup#"+i.id+"_"+s)).append('<div class="buttonFeedback '+r+'"><div class="feedbackContent">'+t+"</div></div>")})}}),window.UnderlineItem=e}($,Item),SingleUnderlineItem.prototype=$.extend(UnderlineItem.getInstance(),{responseIdPattern:/\]\[(.*)\]$/,deselectAll:function(e){e.siblings(".selected").removeClass("selected"),e.siblings().children(":input").attr("disabled",!0)}}),function(a,e){function t(e,t){Item.call(this,e,t),this.constructor=arguments.callee}t.prototype=a.extend(e.getInstance(),{responseIdPattern:/\]\[(.*)\]\[\]$/,loadSolve:function(){var s;if(!1===e||void 0===studentAnswers[this.id])return this.bindEvents(),!1;var e=studentAnswers[this.id],r=this,i="";a.each(e,function(e,n){i=e,n&&(n.correct&&r.object.data("correct",!0),a.each(n.values,a.proxy(function(e,t){void 0!==t&&t.correct?(s=a("#"+r.id+"_"+i+"_"+t.value).prop("disabled",!1),s.parent().addClass("correctAnswer")):delete n.values[e]},r)))}),this.bindEvents()}}),window.MultipleUnderlineItem=t}($,UnderlineItem),PositionalDragAndDropItem.prototype=$.extend(DragAndDropItem.getInstance(),{emptyGap:"",zIndexClassForDragsWrappers:".blockElement",setWidthForExampleElement:function(e,t){e.css("min-width","inherit")},getAnswerElements:function(e,t,n){var s=this.getElement(e,t,n),r=this.getCorrectText(s),i=this.getAnswerClass(n),a=this.getTypeClass(s),o=[];return"wrongAnswer"==i?(t&&o.push({_class:"unavailableAnswer",_value:r,_typeClass:a}),o.push({_class:"wrongAnswer",_value:this.getStudentText(e,n),_typeClass:a})):o.push({_class:i,_value:r,_typeClass:a}),o},addFeedback:function(e){var t,n,s=this.getStudentAnswers(e)||!1;s&&s.feedback&&s.feedback[0]&&(n=s.feedback[0],t=s.correct?"specificCorrectFeedback":"specificWrongFeedback",this.object.find('[name="response['+this.id+"]["+e+']"]').prev().append('<div class="buttonFeedback '+t+'"><div class="feedbackContent">'+n+"</div></div>"))},onReport:function(){this.loadReport(),this.addFeedbacks()},setMinWidth:function(e){e.css("min-width","120px")}}),DraggableJumbledWordsItem.prototype=$.extend(Item.getInstance(),{responseIdPattern:/\]\[(.*)\]$/,prepareToSend:function(){this.object.find('input[name^="response"]').each(function(){var e=$(this),t="";e.parent().find(".drag").each(function(){var e=$(this).attr("value");t=t?t+" "+e:e}),e.val(t)})},getResponseIdForInput:function(e){return!!e.length&&$(e).attr("name").match(this.responseIdPattern)[1]},insertResumedAnswer:function(e){if(wordpoolWrapper=this.object.find(".wordpoolWrapper"),droppableWrapper=this.object.find(".droppableWrapper"),!droppableWrapper.children().hasClass("correctAnswer")){var t=this.getResumedAnswers(this.getResponseIdForInput(e));if(t&&t.values&&t.values.length){var n=t.values[0].value.split(" ");$(n).each(function(){wordpoolWrapper.find("[value="+this+"]").not(".example").appendTo(droppableWrapper)})}}this.upperCaseResumedLetters(droppableWrapper)},upperCaseResumedLetters:function(e){var t,n=this;e.each(function(){(t=$(this)).parent().find(".wordpoolWrapper").hasClass("avoidCapitalization")||t.html(n.setUpperCase(t.html()))})},loadSolve:function(){wordpoolWrapper=this.object.find(".wordpoolWrapper"),droppableWrapper=this.object.find(".droppableWrapper");var r=this;"object"==("undefined"==typeof studentAnswers?"undefined":_typeof(studentAnswers))&&this.object.find(".droppableWrapper").each(function(){var e=r.getResponseIdForInput($(this).find('input[name^="response"]')),t=!1!==e&&r.getStudentAnswers(e);if(t&&t.correct){var n=t.values[0].value.split(" "),s="";$(n).each(function(){var e=wordpoolWrapper.find("[value="+this+"]");s+=e.html(),e.not(".example").clone().appendTo(droppableWrapper),e.not(".example").addClass("disabled"),droppableWrapper.find("[value="+this+"]").css("display","none"),droppableWrapper.css("border","0px solid #cbcbcb").css("background","none")}),droppableWrapper.append("<span></span>"),r.insertStudentAnswers(droppableWrapper.find("span"),[{_class:"correctAnswer",_value:s}],{answer_type:"correctAnswer"}),r.object.find('input[name^="response"]').val(t.values[0].value)}})},loadPreview:function(){var s=this,r=s.object.find(".wordpoolWrapper").addClass("disabled"),i=s.object.find(".droppableWrapper").addClass("disabled").css("background","none");r.find(".drag").draggable("option","disabled",!0),s.object.parent().hasClass("itemExample")||i.find(".example").remove(),s.object.find('[name^="response"]').each(function(){var e=s.getCorrectResponses(s.getResponseIdForInput($(this)))[0].split(" "),t="";$(e).each(function(){var e=r.find("[value="+this+"]").addClass("disabled");t+=e.html()});var n=!s.object.find(".wordpoolWrapper").hasClass("avoidCapitalization");i.append(t).children("span:eq(0)").addClass(n?"capitalizeFirstLetter":null).css("display","inline-block")})},refreshDroppableWrapper:function(e){var t=e.find("div.drag").length;e.toggleClass("empty",0<t)},refreshZIndex:function(){this.object.find(".wordpoolWrapper").css("zIndex","150"),this.object.find(".droppableWrapper").css("zIndex","50")},setZIndexPropertiesForDragsWrappers:function(e){e.closest(".droppableWrapper").css("zIndex","250").siblings().css("zIndex","200")},moveExampleElementsToDroppableWrapper:function(e,t){var n=t.find(".correctAnswer").length;"solve"!==viewMode||n||e.children(".drag.exampleElement").appendTo(t)},init:function(){var a=this,o=this,e=o.object.find(".droppableWrapper").attr("id"),t=o.object.find(".wordpoolWrapper"),d=o.object.find(".droppableWrapper");if(o.object.parent().addTouch(),o.moveExampleElementsToDroppableWrapper(t,d),o.refreshDroppableWrapper(d),t.css("width",o.object.closest(".item").width()-20),o.object.find(".wordpoolWrapper, .droppableWrapper").sortable({connectWith:"."+e,revert:100,items:"> div:not(.example)",cancel:".disabled",start:function(e,t){$that=$(this),t.item.attr("aria-grabbed",!0),d.addClass("highlight"),$(t.helper).css("background","#ebd888"),o.setZIndexPropertiesForDragsWrappers($that),$that.closest(".wordpoolWrapper, .droppableWrapper").css("zIndex","150").siblings().css("zIndex","50")},stop:function(e,t){t.item.attr("aria-grabbed",!1);var n=$(t.item),s=n.find("span").not(".ucfirst"),r=d.find("div:first span"),i=d.find("div:first").next().find("span").not(".ucfirst");d.removeClass("highlight"),s.text()&&(3===s[0].childNodes[0].nodeType?s.text(s.text()[0].toLowerCase()+s.text().slice(1)):$(s[0].childNodes[0]).text(s.text()[0].toLowerCase()+s.text().slice(1))),r.text()&&d.parent().find(".wordpoolWrapper").not(".avoidCapitalization").length&&(3===r[0].childNodes[0].nodeType?r.text(r.text()[0].toUpperCase()+r.text().slice(1)):$(r[0].childNodes[0]).text(r.text()[0].toUpperCase()+r.text().slice(1))),i.text()&&(3===i[0].childNodes[0].nodeType?i.text(i.text()[0].toLowerCase()+i.text().slice(1)):$(i[0].childNodes[0]).text(i.text()[0].toLowerCase()+i.text().slice(1))),n.css("background",""),o.refreshDroppableWrapper(d),o.refreshZIndex()}}).disableSelection(),o.object.find(".droppableWrapper").sortable({over:function(e,t){o.object.find(".droppableWrapper").addClass("ui-state-active")},out:function(e,t){o.object.find(".droppableWrapper").removeClass("ui-state-active")}}).disableSelection(),"solve"===viewMode){var n={dndElement:this.object[0],targetsSelector:"#item"+this.id+" .itemContent div.droppableWrapper",wordpoolSelector:"#item"+this.id+" .itemContent div.wordpoolWrapper",itemsSelector:"div.drag:not(.example)",wordpoolItemsSelector:[],backgroundColor:"#fffad7",stateActiveClass:"ui-state-active",styleOpactityValue:.5,isMultipleActivitiesPerPage:!0,shouldPreventClickHandler:!0,afterDropCallback:function(e){var t=e.announceMessage,n=e.targets;function s(e,s){e.forEach(function(e,t){var n=e.textContent;e.textContent=0!==t||s?n.toLowerCase():n.charAt(0).toUpperCase()+n.slice(1)})}o.refreshDroppableWrapper($(n[0])),o.refreshZIndex(),n[0].style.backgroundColor="transparent";var r=Array.from(a.object[0].querySelectorAll(".wordpoolWrapper div.drag span")),i=Array.from(a.object[0].querySelectorAll(".droppableWrapper div.drag span"));s(r,!0),s(i,!1),t(i.map(function(e){return e.textContent.trim()}).join(" "))}};new DragAndDropPlugin(n)}},prepareEvents:function(){"report"!==viewMode&&"preview"!==viewMode||(this.object.find(".drag").draggable("option","disabled",!0),this.object.find(".droppableWrapper").droppable("option","disabled",!0)),this.object.find(".drag").filter(".example").draggable("option","disabled",!0),this.object.find(".droppableWrapper").filter(".example").droppable("option","disabled",!0)},loadReport:function(){var r=this.object.find(".wordpoolWrapper"),e=this.object.find(".droppableWrapper"),i=this;if(e.find(".buttonFeedback").addClass("disabled"),this.object.parent().hasClass("itemExample")||e.find(".example").remove(),"object"==("undefined"==typeof studentAnswers?"undefined":_typeof(studentAnswers))){var t,n,a,o,s,d=i.getResponseIdForInput(e.find('input[name^="response"]')),c="",l="",u=[],p=[],h=!!d&&i.getStudentAnswers(d);h&&(t=h.correct,n=""===(n=h.values[0].value.split(" "))[0]||n.length==r.find(".example").length?[]:n,$(n).each(function(){var e=r.find("[value="+this+"]");c+=e.html()}),(a=i.getCorrectResponses(d))&&($.each(a,function(e,t){var n,s=[];o=a[e].split(" "),$.each(o,function(){var e=r.find("[value="+this+"]");s.push(e.text())}),n=s.join(" "),r.hasClass("avoidCapitalization")||(n=i.setUpperCase(n)),-1===$.inArray(n,p)&&p.push(n)}),l=p[0]),s=t?(u[0]={_class:"correctAnswer",_value:c},"correctAnswer"):n.length?(a&&(u[0]={_class:"unavailableAnswer",_value:l}),u[u.length]={_class:"wrongAnswer",_value:c},"wrongAnswer"):(u[0]={_class:"noAnswer",_value:l||Item.EMPTY_GAP},"noAnswer"),e.prepend("<span></span>"),i.insertStudentAnswers(e.find("span").first(),u,{_answers:!!p.length&&p,answer_type:s}),e.find("span").first().append('<span class="answerIcon">'),e.children('span[class$="Answer"]').each(function(){r.hasClass("avoidCapitalization")||$(this).html(i.setUpperCase($(this).html()))})),e.css({border:"0px solid #cbcbcb",background:"none","vertical-align":"baseline"})}r.find(".drag").addClass("disabled"),e.find(".wrongAnswer, .correctAnswer, .noAnswer, .unavailableAnswer").parent().css({display:"inline","padding-left":"0"})},setUpperCase:function(e){var t,n=$("<span/>").html(e);return(t=n.children(":not(input):first")).text()&&(3===t[0].childNodes[0].nodeType?t.text(t.text()[0].toUpperCase()+t.text().slice(1)):$(t[0].childNodes[0]).text(t.text()[0].toUpperCase()+t.text().slice(1))),n.html()},checkFilledAnswers:function(){return!!this.object.parent().hasClass("itemExample")||!!this.object.find(".droppableWrapper .drag:not(.example)").length},addFeedback:function(e){var t,n,s=this.getStudentAnswers(e)||!1;s&&"string"==typeof(t=this.getFeedbackValue(s))&&t.length&&(n=s.correct?"specificCorrectFeedback":"specificWrongFeedback",this.object.find('[name="response['+this.id+"]["+e+']"]').parent().append('<div class="buttonFeedback '+n+'"><div class="feedbackContent">'+t+"</div></div>"))}}),MatchingItem.prototype=$.extend(Item.getInstance(),{start:function(){var e=this;this.paper={},this.paperWidth=150,this.paperHeight=0,this.colorLine="#87b6d2",this.leftElement="",this.rightElement="",this.lines=[],this.core=$("#"+this.id+"_"+this.getResponseId()),this.reportStatusImageLeft=-7,this.leftDrawLineMargin=0,this.rightDrawLineMargin=0,this.leftDrawTopMargin=-2.5,this.incorrectColor="#ee3333",this.correctColor="#558624",this.strokeWidth=3,this.preparePaper(),this.prepareLines(function(){return e.core.find(".hiddenInputs input:disabled")},!0,"#000")},afterPageFullyLoaded:function(e){"complete"===document.readyState?e():$(window).load(e)},loadSolve:function(){"use strict";var e=this;return this.afterPageFullyLoaded(function(){e.start(),e.loadCorrectStudentAnswers(),e.loadResumedAnswersOnStart(),e.bindEvents()}),!0},bindEvents:function(){var e=this;this.core.find(".matchingElement").not(".example, .disabled").on("click",function(){e.selectItem($(this))}).addTouch()},preparePaper:function(){var e,t,n=this.core;e=n.find(".matchingGroup.left").height(),t=n.find(".matchingGroup.right").height(),this.paperHeight=t<e?e:t,this.paper=Raphael(n.find(".matchingLines")[0],this.paperWidth,this.paperHeight),n.find(".matchingLines").css({width:this.paperWidth,height:this.paperHeight})},prepareLines:function(e,s,r){var i=this;r=void 0===r?this.colorLine:r,e(function(){}).each(function(){var e="",t="",n=$(this).attr("value").split(" ");e=$("#"+i.id+"_"+i.getResponseId()+"_left_"+n[0]),t=$("#"+i.id+"_"+i.getResponseId()+"_right_"+n[1]),s?(e.addClass("example"),t.addClass("example"),i.drawLine(e,t,r)):i.createLine(e,t,r,function(e){e.line.click(function(){i.removeLine(e)})})})},selectItem:function(e){var t;e.closest(".matchingGroup").hasClass("left")?this.leftElement=e:this.rightElement=e,0<(t=e.siblings(".selected")).length&&t.removeClass("selected"),e.addClass("selected"),this.matchingItems()},matchingItems:function(){var t=this;if(""!==this.leftElement&&""!==this.rightElement){for(var e=this.lines.length;e--;)this.checkLine(this.lines[e])&&this.removeLine(this.lines[e]);this.createLine(this.leftElement,this.rightElement,null,function(e){e.line.click(function(){t.removeLine(e)})}),this.resetDraw()}this.updateAnswers()},updateAnswers:function(){var n,e=this.core.find(".hiddenInputs input").not(".example"),s=this.lines;e.each(function(e,t){(t=$(t)).attr("disabled",!1),answer=s[e],""==(n="undefined"!=typeof answer?answer.key:"")?(t.attr("disabled",!0),t.removeAttr("value")):t.val(n)})},updateInputs:function(){var e=this.core.find(".hiddenInputs input").not(".example"),s=this.lines;this.object.find(".hiddenInputs input").not(".example").removeAttr("value"),e.each(function(e,t){var n=$(t).attr("disabled",!1);answer=s[e],""==(t="undefined"!=typeof answer?answer.key:"")?n.attr("disabled",!0):n.val(t)})},removeLine:function(e){for(var t=0,n=0;n<this.lines.length;n++)if((t=this.lines[n])===e){t.A.removeClass("matched"),t.B.removeClass("matched"),t.line.remove(),this.lines.splice(n,1);break}},removeLines:function(){if(this.lines.length){for(var e=0;e<this.lines.length;e++){this.lines[e].line&&this.lines[e].line.remove()}this.lines=[]}},checkLine:function(e){return e.A[0]===this.leftElement[0]||e.B[0]===this.rightElement[0]},resetDraw:function(){this.leftElement.removeClass("selected"),this.rightElement.removeClass("selected"),this.leftElement="",this.rightElement=""},createLine:function(e,t,n,s){var r,i;return r=this.drawLine(e,t,n),i=e.attr("data-id")+" "+t.attr("data-id"),line={line:r,id:r.id,key:i,A:e,B:t},this.lines.push(line),void 0!==s&&s(line),line},drawLine:function(e,t,n){var s=function(e,t){var n=5<Math.floor(10*Math.random()),s=Math.floor(Math.random()*e);return t&&n?-s:s},r=this.leftDrawLineMargin,i=this.object.find(".matchingLines").width()-this.rightDrawLineMargin,a=e.position(),o=t.position(),d=a.top+(e.outerHeight()/2-this.leftDrawTopMargin),c=o.top+(t.outerHeight()/2-this.leftDrawTopMargin),l=(r+s(100)).toFixed(3),u=d.toFixed(3),p=(i-s(100)).toFixed(3),h=c.toFixed(3);n=n||this.colorLine,e.addClass("matched"),t.addClass("matched"),l=parseInt(l,10)+s(10),p=parseInt(p,10)+s(10),u=parseInt(u,10)+s(10),h=parseInt(h,10)+s(10);var f=["M",r.toFixed(3),d.toFixed(3),"C",l,u,p,h,i.toFixed(3),c.toFixed(3)].join(",");return this.paper.path(f).attr({stroke:n,fill:"none",opacity:0,"stroke-width":this.strokeWidth,"stroke-linecap":"round",cursor:"pointer"}).animate({opacity:1},500)},prepareToSend:function(){this.updateAnswers()},getResponseId:function(){return this.object.find('.matching[id^="'+this.id+'"]').attr("id").substr(this.id.length+1)},loadResumedAnswersOnStart:function(){if("undefined"!=typeof resumedAnswers&&resumedAnswers){var e=this.getResumedAnswers(this.getResponseId());if(e&&e.values){var r=this.object.find('[name^="response"]:hidden').not(".example, .disabled");$.each(e.values,function(e,t){$(r[e]).val(t.value),$(r[e]).attr("disabled",!1);var n=$("#"+this.id+"_"+this.getResponseId()+"_left_"+t.value.split(" ")[0]),s=$("#"+this.id+"_"+this.getResponseId()+"_right_"+t.value.split(" ")[1]);n.hasClass("disabled")||s.hasClass("disabled")||this.createLine(n,s)}.bind(this))}}},loadResumedAnswers:function(){},loadCorrectStudentAnswers:function(){var e=this.getStudentAnswers(this.getResponseId());if(e&&e.values){var r=this.object.find('[name^="response"]:hidden').not(".example");$.each(e.values,function(e,t){if(t.correct){var n=$("#"+this.id+"_"+this.getResponseId()+"_left_"+t.value.split(" ")[0]),s=$("#"+this.id+"_"+this.getResponseId()+"_right_"+t.value.split(" ")[1]);n.addClass("disabled").addClass("correctAnswer"),s.addClass("disabled").addClass("correctAnswer"),this.renderMarkers(),$(r[e]).val(t.value),$(r[e]).attr("disabled",!0),$(r[e]).addClass("disabled"),this.createLine(n,s,"#558624")}}.bind(this))}},renderMarkers:function(){var o=this;this.object.find(".matchingGroup.right").children("ul").css("position","relative").children("li").each(function(e,t){var n,s,r,i=$(this),a=i.position();i.hasClass("wrongAnswer")?n="wrongAnswer":i.hasClass("correctAnswer")&&(n="correctAnswer"),a.left,s=a.top+i.height()/2-5,r=i.outerWidth(!0)+o.reportStatusImageLeft+10,i.parent().append($("<span/>",{class:n,style:"position:absolute;top:"+s+"px;left:"+r+"px;height:20px;width:30px;"}))})},renderCorrectAnswers:function(){this.removeLines();var r=this.getResponseId(),e=this.getCorrectResponses(r),i=this.object.find('[name^="response"]:hidden').not(".example");$.each(e,function(e,t){this.object.find(".matchingElement:not(.example)").removeClass("wrongAnswer noAnswer").addClass("correctAnswer");var n=$("#"+this.id+"_"+r+"_left_"+t.split(" ")[0]),s=$("#"+this.id+"_"+r+"_right_"+t.split(" ")[1]);n.hasClass("matched")||s.hasClass("matched")||(n.addClass("disabled matched"),s.addClass("disabled matched"),$(i[e]).val(t),$(i[e]).attr("disabled",!0),$(i[e]).addClass("disabled"),this.createLine(n,s))}.bind(this))},loadPreview:function(){var e=this;this.afterPageFullyLoaded(function(){e.start(),e.renderCorrectAnswers(),e.updateInputs()})},renderStudentAnswers:function(){this.object.find(".matchingElement").not(".example").removeClass("matched");var i=this.getResponseId(),e=this.getStudentAnswers(i).values,a=this;this.object.find(".matchingElement").removeClass("correctAnswer wrongAnswer noAnswer"),this.removeLines(),$(e).each(function(e,t){var n=t.value.split(" "),s=$("#"+a.id+"_"+i+"_left_"+n[0]),r=$("#"+a.id+"_"+i+"_right_"+n[1]);t.correct?(color=a.correctColor,s.addClass("correctAnswer"),r.addClass("correctAnswer")):(color=a.incorrectColor,s.addClass("wrongAnswer"),r.addClass("wrongAnswer")),a.createLine(s,r,color)}),this.object.find(".matchingGroup ul li").not(".example, .correctAnswer, .wrongAnswer").addClass("noAnswer"),this.object.find(".matchingElement").addClass("matched"),this.updateInputs()},loadReport:function(){var t=this;this.afterPageFullyLoaded(function(){if(t.start(),correctAnswers){t.object.append('<a class="button">Show correct answers</a>');var e=t.object.find(".button").attr("answerType","correct");t.object.find(".matchingElement").not(".examples").removeClass("matched"),t.renderStudentAnswers(),e.click(function(){"correct"==e.attr("answerType")?(this.removeLines(),this.object.find(".matchingGroup.right ul").css("position","inherit"),this.object.find(".matchingElement").not(".example").removeClass("matched"),this.renderCorrectAnswers(),this.updateInputs(),this.object.find(".matchingGroup.right ul").css("position","relative"),e.attr("answerType","student").text("Show submitted answers")):(this.object.find(".matchingGroup.right ul").css("position","inherit"),this.renderStudentAnswers(),this.object.find(".matchingGroup.right ul").css("position","relative"),e.attr("answerType","correct").text("Show correct answers"))}.bind(t))}else t.renderStudentAnswers();t.object.find(".matchingElement").not(".example, .correctAnswer, .wrongAnswer").addClass("noAnswer"),t.renderMarkers()})},onReport:function(){this.addFeedbacks(),this.loadReport()},addFeedbacks:function(){var e=this.object.find(".matching").attr("id").substr(this.id.length+1),i=this.getStudentAnswers(e)||!1,t=i.feedback||[],a=this;$.each(t,function(n,e){var t,s,r;(r=a.object.find("[data-id="+n+"]:not(.example)"))&&(s=(t=i.values.filter(function(e){var t=e.value.split(" ");return!!t[0]&&inArray(n,t)}))[0]&&t[0].correct?"specificCorrectFeedback":"specificWrongFeedback",r.prepend('<div class="buttonFeedback '+s+'"><div class="feedbackContent">'+e+"</div></div>"))})},checkFilledAnswers:function(){var e=this.object.find(".matchingGroup.left .matchingElement:not(.matched)").length,t=this.object.find(".matchingGroup.right .matchingElement:not(.matched)").length;return!(e&&t)}}),HangmanItem.prototype=$.extend(Item.getInstance(),{responseIdPattern:/\]\[(.*)\]$/,prepareToSend:function(){this.object.find(".hangmanGroup.example input[readonly]").attr("disabled","disabled"),this.object.find('input[name^="response"]').each(function(){var e=$(this);if(0===e.parent().find("input:text").length)e.val($(this).parent().find(".correctAnswer").html());else{var t="";e.parent().find("input:text").each(function(){var e=$(this).val();e=e.length?e:"_",t+=e}),e.val(t)}})},loadSolve:function(){this.object.find('input:hidden[name^="response"]').each(function(e,t){var n=this.getResponseIdForInput($(t)),s=this.getStudentAnswers(n);s&&s.correct&&(this.insertStudentAnswers($(t),[{_class:"correctAnswer",_value:s.values[0].value}],{_hideOnly:!0}),$(t).parent().find("input:text").remove())}.bind(this))},loadPreview:function(){this.object.find('.hangmanGroup:not(.example) > input:hidden[name^="response"]').each(function(e,t){this.getCorrectResponse(this.getResponseIdForInput($(t)));this.insertCorrectAnswer($(t))}.bind(this))},clickableInputDef:"input[type='text']:not('.filled'):not(:disabled)",isFirstInputInItem:function(e){return!e.prevAll(this.clickableInputDef).length&&!e.parent(".hangmanGroup").prevAll(".hangmanGroup").children(this.clickableInputDef).length},isLastInputInItem:function(e){return!e.nextAll(this.clickableInputDef).length&&!e.parent(".hangmanGroup").nextAll(".hangmanGroup").children(this.clickableInputDef).length},goToNextInputInItem:function(e){var t=e.nextAll(this.clickableInputDef);t.length||(t=e.parent(".hangmanGroup").nextAll(".hangmanGroup").children(this.clickableInputDef)),$(t[0]).trigger("click")},goToNextInputInTask:function(e){var t=e.nextAll(this.clickableInputDef);t.length?$(t[0]).trigger("click"):(t=e.parent(".hangmanGroup").nextAll(".hangmanGroup").children(this.clickableInputDef)).length?$(t[0]).trigger("click"):(t=e.closest(".item").nextAll(".item").find(this.clickableInputDef)).length&&$(t[0]).trigger("click")},goToPrevInputInItem:function(e){var t=e.prevAll(this.clickableInputDef);t.length?$(t[0]).trigger("click"):(t=e.parent(".hangmanGroup").prevAll(".hangmanGroup").children(this.clickableInputDef),$(t.last()).trigger("click"))},init:function(){var n,s=this;n={backspace:8,tab:9,shift:16,ctrl:17,alt:18,left:37,up:38,right:39,down:40},s.object.delegate(s.clickableInputDef,"keydown",function(e){var t=$(this);setTimeout(function(){-1!=$.inArray(e.keyCode,[n.backspace,n.left])?(s.isFirstInputInItem(t)?t.trigger("click"):s.goToPrevInputInItem(t),e.returnValue=!1):e.keyCode==n.right?(s.isLastInputInItem(t)?t.trigger("click"):s.goToNextInputInItem(t),e.returnValue=!1):e.keyCode==n.tab&&e.shiftKey?s.goToPrevInputInItem(t):e.keyCode==n.tab?(s.goToNextInputInTask(t),e.returnValue=!1):-1!=$.inArray(e.keyCode,[n.up,n.down,n.shift,n.alt,n.ctrl])?(t.trigger("click"),e.returnValue=!1):s.isLastInputInItem(t)?t.trigger("click"):s.goToNextInputInItem(t)},20)}),s.object.delegate(s.clickableInputDef,"click",function(){$(this).focus().select(),this.setSelectionRange&&this.setSelectionRange(0,1)}),s.object.delegate(s.clickableInputDef,"mouseup, mousedown, blur",function(e){e.returnValue=!1})},getResponseIdForInput:function(e){return $(e).attr("name").match(this.responseIdPattern)[1]},insertResumedAnswer:function(e){if(!e.next().hasClass("correctAnswer")){var t=this.getResumedAnswers(this.getResponseIdForInput(e));if(t.values&&t.values[0]){var n=t.values[0].value;$(e).parent().find("input:text").each(function(e,t){"_"!=n[e]&&$(t).val(n[e])})}}},insertCorrectAnswer:function(e){var n=this.getCorrectResponse(this.getResponseIdForInput(e));$(e).parent().find("input:text").each(function(e,t){"_"!=n[e]&&($(t).val(n[e]),$(t).attr("disabled",!0))})},getResponseId:function(){this.object.find("#item"+this.id).each(function(){this.attr("id").substr(4)})},loadReport:function(){var p=this;p.object.find(".hangmanGroup").each(function(){var e,t,n,s,r,i,a,o,d,c,l=$(this),u=l.attr("id").substr(p.id.length+1);!1===l.hasClass("example")&&0!=l.children("input").length?(n=p.getStudentAnswers(u),i=p.getCorrectResponse(u),s=p.getCorrectResponses(u),n&&void 0!==(e=p.getAnswer(n))&&(t=$("<span>"),r=$("<span>"),!0===e.correct?(t.html(e.value).addClass("correctAnswer"),p.addAlternativeAnswers(t,s)):(a=e.value,o=l.find("input:text"),d=!0,(c=htmlUnescape(a)).length==o.length&&($.each(c,function(e,t){"_"==t||$(o[e]).hasClass("filled")||(d=!1)}),d)?(t.addClass("noAnswer"),i?(t.html(i),p.addAlternativeAnswers(t,s)):t.html(e.value.replace(/[^_]+/g,"_"))):(t.addClass("wrongAnswer"),i?(r.html(i).addClass("unavailableAnswer"),t.html(e.value),p.addAlternativeAnswers(t,s)):t.html(e.value))),l.html(t),l.append(r),p.addFeedback(n,this))):$(this).parent().parent().hasClass("itemExample")||l.html(p.getAnswerOfItem(this))})},addFeedback:function(e,t){if(e&&e.feedback&&e.feedback[0]){var n=e.correct?"specificCorrectFeedback":"specificWrongFeedback";$(t).append('<div class="buttonFeedback '+n+'"><div class="feedbackContent">'+e.feedback[0]+"</div></div>")}},getAnswerOfItem:function(e){var t="";return $(e).find("input:text").each(function(){t+=$(this).val()}),t},getAnswer:function(e){if(e.values.length)return e.values[0]},checkFilledAnswers:function(){return!!this.object.parent().hasClass("itemExample")||!this.object.find('.hangmanGroup :text[value=""]').length}}),$.extend(Square.prototype,new Component),$.extend(Phrase.prototype,new Component,{createSquares:function(e){var t,n,s=this,r=s.prepareInputs(e),i=r.length;if(i){for(t=0;t<i;t++)n=new Square(s,r[t]),s.squares.push(n);for(t=0;t<i;t++)s.squares[t].prev=0==t?null:s.squares[t-1],s.squares[t].next=t==i-1?null:s.squares[t+1]}},prepareInputs:function(e){var n=this,s={};return e.each(function(e,t){t=$(t),"vertical"==n.hiddenInput.data("direction")?s[t.data("y")]=t:s[t.data("x")]=t}),n.sortInputs(s)},sortInputs:function(n){var s=[];return $.each(getKeys(n).sort(function(e,t){return e-t}),function(e,t){s.push(n[t])}),s},getSquareByInput:function(e){var t,n=null,s=e.attr("id"),r=this.squares.length;for(t=0;t<r;t++)if(this.squares[t].input.attr("id")==s){n=this.squares[t];break}return n},getFirstNonExampleSquare:function(e){for(var t=null==e?0:e,n=this.squares.length;t<n;t++)if(!this.squares[t].example)return this.squares[t];return!1},moveToNext:function(e){if(e){var t=e.getFirstNonExampleSquare();t?(t.input.focus().select(),(e.crosswordItem.currentPhrase=e).crosswordItem.currentSquare=t):e.moveToNext(e.next)}}}),CrosswordItem.prototype=$.extend(Item.getInstance(),{phrases:[],currentSquare:null,currentPhrase:null,responseIdPattern:/\]\[(.*)]$/,clickableInputDef:"input:not('.filled, .cw-first, [disabled='disabled']')",keyCodes:{backspace:8,tab:9,shift:16,ctrl:17,alt:18,space:32,left:37,up:38,right:39,down:40},keyCodesPreciseDirections:{37:"left",38:"up",39:"right",40:"down"},keyCodesDirections:{37:"horizontal",38:"vertical",39:"horizontal",40:"vertical"},onShow:function(){this.init(),this.prepareView()},onReport:function(){this.loadReport()},prepareView:function(){switch(!0){case"preview"==window.viewMode:this.loadPreview();break;case"report"==window.viewMode:this.onReport();break;case"solve"==window.viewMode:this.loadSolve(),this.loadResumedAnswers(),this.prepareEvents()}},init:function(){var e,t,a=this;if(a.phrases=[],a.object.find('input[type=hidden][name*="response"]').each(function(e,t){var n=$(t),s=a.getResponseIdForInput(t),r=new Phrase(n,s,a),i=a.object.find(".response-"+s);r.createSquares(i),a.phrases.push(r)}),t=a.phrases.length)for(e=0;e<t;e++)a.phrases[e].prev=0==e?null:a.phrases[e-1],a.phrases[e].next=e==t-1?a.phrases[0]:a.phrases[e+1]},prepareEvents:function(){var i=this;window.isMobile=void 0!==window.isMobile&&window.isMobile,window.isMobile?($(i.clickableInputDef,i.object).on({focus:function(){this.setSelectionRange(0,1)},keyup:function(){this.setSelectionRange(0,1)}}).attr({autocapitalize:"off",autocomplete:"off"}),$(i.object.find(".crossword")).addTouch()):i.object.find(i.clickableInputDef).on({keydown:function(s){var r=$(this);setTimeout(function(){if(s.keyCode==i.keyCodes.tab)i.currentPhrase.moveToNext(i.currentPhrase.next);else{if(inArray(s.keyCode,[i.keyCodes.shift,i.keyCodes.alt,i.keyCodes.ctrl]))return!1;var e,t,n=i.currentPhrase.getSquareByInput(r);if(s.keyCode==i.keyCodes.backspace)t="vertical"==(e=n.phrase.hiddenInput.data("direction"))?"up":"left";else if(s.keyCode==i.keyCodes.space)r.hasClass("correctAnswer")||r.val(""),t="vertical"==(e=n.phrase.hiddenInput.data("direction"))?"down":"right";else{if(void 0===n)return;e=null!=i.keyCodesDirections[s.keyCode]?i.keyCodesDirections[s.keyCode]:n.phrase.hiddenInput.data("direction"),t=null!=i.keyCodesPreciseDirections[s.keyCode]?i.keyCodesPreciseDirections[s.keyCode]:"vertical"==e?"down":"right"}n.move(e,t)}},0)},click:function(e){var t,n=$(this),s=null;"vertical horizontal"==n.data("direction")&&i.currentPhrase&&(n.attr("id")==i.currentSquare.input.attr("id")?s=i.currentPhrase.responseId:i.currentPhrase.getSquareByInput(n)&&(s=i.getResponseIdsArray(n,i.currentPhrase.responseId))),t=i.getResponseIdsArray(n,s),i.currentPhrase=i.getPhrase(t,!0),i.currentSquare=i.currentPhrase.getSquareByInput(n),n.focus().select(),this.setSelectionRange&&this.setSelectionRange(0,1)},mouseup:function(e){e.returnValue=!1},mousedown:function(e){e.returnValue=!1},blur:function(e){e.returnValue=!1}})},getResponseIdForInput:function(e){return $(e).attr("name").match(this.responseIdPattern)[1]},getResponseIdsArray:function(e,s){var r=[];return $.each(e.attr("class").split(" "),function(e,t){var n=t.match(/response-(\S*)/);n&&n[1]!=s&&r.push(n[1])}),r},getPhrase:function(e,t){for(var n=0,s=null,r=this.phrases.length;n<r&&(!inArray(this.phrases[n].responseId,e)||(s=this.phrases[n],!t));n++);return s},prepareToSend:function(){var e,t,n,s,r,i,a=this.phrases.length;for(e=0;e<a;e++){for(i="",r=(s=this.phrases[e]).squares.length,t=0;t<r;t++)i+=(n=s.squares[t].input).val().length?n.val():"_";s.hiddenInput.val(i)}},loadSolve:function(){var e,t,n,s,r,i,a,o,d=this.phrases.length;for(e=0;e<d;e++)if(s=this.phrases[e],(o=this.getStudentAnswers(s.responseId)).correct)for(a=s.squares.length,r=o.values[0].value,s.hiddenInput.addClass("correctAnswer"),t=0;t<a;t++)i=(n=s.squares[t].input).hasClass("example")?"":"correctAnswer",n.val(r[t]).addClass(i).attr("readonly",!0)},loadResumedAnswers:function(){var e,t=this.phrases.length;for(e=0;e<t;e++){var n=this.phrases[e],s=this.getResumedAnswers(n.responseId);if(s&&s.values[0].value)for(var r=0,i=n.squares.length,a=s.values[0].value;r<i;r++){var o=n.squares[r].input;o.hasClass("example")||"_"!=a[r]&&o.val(a[r])}}},loadPreview:function(){var e,t=this.phrases.length;for(e=0;e<t;e++)for(var n=this.phrases[e],s=this.getCorrectResponse(n.responseId),r=0,i=n.squares.length;r<i;r++){n.squares[r].input.val(s[r]).attr("readonly",!0)}},loadReport:function(){for(var n={},e=this.phrases.length,t=0;t<e;t++)for(var s=this.phrases[t],r=s.squares.length,i=this.getStudentAnswers(s.responseId),a=i.values[0].value,o=this.getCorrectResponse(s.responseId),d=-1<a.indexOf("_"),c=0;c<r;c++){var l,u,p=s.squares[c].input;p.hasClass("correctAnswer")||p.hasClass("example")||(u=o?(l=o[c],i.correct?"correctAnswer":"noAnswer"):(l=""!=p.val()?p.val():d?"":a[c],i.correct?"correctAnswer":"wrongAnswer"),p.val(l).removeClass("noAnswer wrongAnswer").addClass(u).attr("readonly",!0)),!1!==o&&(n.hasOwnProperty(p.attr("id"))||(n[p.attr("id")]=[]),$.each(this.getCorrectResponseArray(s.responseId),function(e,t){n[p.attr("id")].push(t.toUpperCase())}))}this.prepareAlternativeAnswers(n)},getCorrectResponseArray:function(e){var t=this.getCorrectResponses(e);return!1!==t&&(t||null)},prepareAlternativeAnswers:function(e){var r=this;$.each(e,function(e,t){var n=$("#"+e),s=$("<span/>",{class:"alternativeAnswerSpan",style:n.attr("style")+";width: 28px; height:28px; background:url(data:image/gif;base64,AAAA)"});n.after(s),r.addAlternativeAnswers(s,t)})},checkFilledAnswers:function(){return!this.object.find(':text[class^="response-"][value=""]').length}}),WordsearchItem.prototype=$.extend(Item.getInstance(),{clicked:!1,activePoint:!1,getResponseId:function(){return this.object.find(".wordsearchGrid").attr("id").substr(3)},init:function(){this.draw()},loadResumedAnswers:function(){var n=this,e=n.getResumedAnswers(n.getResponseId());e&&e.values&&($.each(e.values,function(e,t){0===n.object.find(".wordsearchAnswersList").find('[data-id="'+t.value+'"]').length&&n.addAnswer(t.value,void 0,t.value)}),n.deleteAnswersEvent(),n.draw())},loadSolve:function(){this.deleteAnswersEvent(),this.addClickEvent(),this.addMouseEnterEvent(),this.addMouseLeaveEvent();var n=this,e=this.getStudentAnswers(this.getResponseId());e&&e.values&&($.each(e.values,function(e,t){!0===t.correct&&n.addAnswer(t.value,"correctAnswer",t.value)}),n.draw())},loadPreview:function(){var n=this,e=n.getCorrectResponses(this.getResponseId());$.each(e,function(e,t){n.addAnswer(t,"previewAnswer")}),this.addAnswerHoverEvent()},loadReport:function(){var n=this,e=n.getStudentAnswers(this.getResponseId()),s=this.object.find(".wordsearchAnswersList");$.each(e.values,function(e,t){n.addAnswer(t.value,t.correct?"correctAnswer":"wrongAnswer")}),e=n.getCorrectResponses(this.getResponseId()),$.each(e,function(e,t){0===s.find('input:hidden[value="'+t+'"]').length&&n.addAnswer(t,"noAnswer")}),this.addAnswerHoverEvent()},getExamplesPoints:function(){var e=[];return this.object.find("."+this.id+"Example").each(function(){e.push($(this).val())}),e},getResponseIdForInput:function(){return this.getResponseId()},deleteAnswersEvent:function(){var e=this;e.object.find(".wsAnswers").click(function(){$(this).remove(),e.draw()})},addAnswer:function(e,t,n){var s,r,i=this.object.find(".wordsearchAnswersList"),a=this.getExamplesPoints();0===i.find('[data-id="'+e+'"]').length&&-1===$.inArray(e,a)&&(s=$("<li/>",this.prepareAttibutes(t,n)),r=$("<input/>",{type:"hidden",name:"response["+this.id+"]["+this.getResponseId()+"][]",value:e}),s.append($("<span/>",{class:"itemContentText",text:this.getValue(e)})),s.append(r),i.append(s))},addClickEvent:function(){var e,t,n,s=this;s.object.find(".wordsearchItem").click(function(){s.selectElement(this),s.clicked?(s.clicked=!1,e=s.object.find(".start").attr("id").split("-"),t=$(this).attr("id").split("-"),void 0!==(n=s.getPoint(e,t))&&s.addAnswer(n,void 0,n),s.activePoint=!1,s.object.find(".wordsearchItem").removeClass("start"),s.deleteAnswersEvent(),s.deleteLine(),s.draw()):(s.clicked=!0,s.activePoint=!1,$(this).addClass("start"))})},addMouseEnterEvent:function(){var e,t,n,s=this;s.object.find(".wordsearchItem").mouseenter(function(){s.clicked&&(e=s.object.find(".start").attr("id").split("-"),t=$(this).attr("id").split("-"),void 0!==(n=s.getPoint(e,t))&&s.drawLine(n))})},addAnswerHoverEvent:function(){var t=this;t.object.find('[class$="Answer"]').hover(function(){var e=$(this).find("input").attr("value");t.drawLine(e)},function(){t.deleteLine()})},addMouseLeaveEvent:function(){var e=this;e.object.find(".wordsearchItem").mouseleave(function(){e.clicked&&($(this).removeClass("stop"),e.deleteLine())})},getValue:function(e){for(var t="",n=this.preparePoint(e),s=n.length,r=0;r<s;r++)t+=$("#"+n[r]).html();return t},getPoint:function(e,t){var n,s,r=this.getDirection(e,t);if(!1!==r&&("EE"===r?n=t[1]-e[1]+1:"SS"===r?n=t[2]-e[2]+1:"SE"===r?n=t[2]-e[2]+1:"NE"===r&&(n=e[2]-t[2]+1),s=r+"_"+e[1]+"_"+e[2]+"_"+n),void 0!==n)return s},getDirection:function(e,t){var n=e[1]-t[1],s=e[2]-t[2];return!(!n&&!s||n&&s&&Math.abs(n)!=Math.abs(s))&&(0<n?0<s?"NW":s<0?"SW":"WW":n<0?0<s?"NE":s<0?"SE":"EE":0<s?"NN":s<0&&"SS")},draw:function(){var t,n,s=this;s.deselectAllElement(),s.object.find(".wordsearchAnswersList li").each(function(){if(void 0!==(t=$(this).attr("data-id"))){n=s.preparePoint(t);for(var e=0;e<n.length;e++)s.selectElement($("#"+n[e]))}}),s.drawExample()},drawExample:function(){var n,s=this,e=s.getExamplesPoints();$.each(e,function(e,t){n=s.preparePoint(t),$.each(n,function(e,t){s.selectElement($("#"+t))})})},drawLine:function(e){for(var t=this.preparePoint(e),n=t.length,s=0;s<n;s++)this.selectElement($("#"+t[s])),this.activePoint=e},deleteLine:function(){var e,t;if(this.activePoint){t=(e=this.preparePoint(this.activePoint)).length;for(var n=0;n<t;n++)this.deselectElement($("#"+e[n]));this.activePoint=!1,this.draw()}},preparePoint:function(e){var t,n,s,r=e.split("_"),i=[];switch(r[0]){case"EE":for(t=0;t<r[3];t++)n=parseInt(r[1],10)+t,s=r[2],i.push(this.id+"-"+n+"-"+s);break;case"SS":for(t=0;t<r[3];t++)n=parseInt(r[1],10),s=parseInt([r[2]],10)+t,i.push(this.id+"-"+n+"-"+s);break;case"NE":for(t=0;t<r[3];t++)n=parseInt(r[1],10)+t,s=parseInt(r[2],10)-t,i.push(this.id+"-"+n+"-"+s);break;case"SE":for(t=0;t<r[3];t++)n=parseInt(r[1],10)+t,s=parseInt(r[2],10)+t,i.push(this.id+"-"+n+"-"+s)}return i},selectElement:function(e){$(e).addClass("active")},deselectElement:function(e){$(e).removeClass("active")},deselectAllElement:function(){this.object.find(".wordsearchItem").removeClass("active")},prepareAttibutes:function(e,t){var n={class:e||"wsAnswers"};return t&&(n["data-id"]=t),n},checkFilledAnswers:function(){return!!this.object.find('[name^="response"]').length}}),InsertAWordItem.prototype=$.extend(FillinItem.getInstance(),{init:function(){var e="preview"===window.viewMode?"input[type=text]":"[disabled][type=text]";this.object.find(e).width(1),this.object.find("input").each(function(e,t){(t=$(t)).autoResize({comfortZone:5,minWidth:t.width(),maxWidth:t.parents("li.item").width()})})},prepareEvents:function(){"report"!=window.viewMode&&"preview"!=window.viewMode&&this.object.find(".switcher").hover(function(){var e=$(this);if(e.prev().length&&e.prev().prev("input").length){var t=e.prev().prev("input");t.is(":not(:focus):not(.example):not(:disabled)")&&($(".insertAWord input:text[value='']").hide(),t.show().focus())}},function(){})},insertResumedAnswer:function(e){var t;e.next().hasClass("correctAnswer")||void 0!==(t=this.getResumedAnswers(this.getResponseIdForInput(e))).values&&0<t.values.length&&void 0!==t.values[0]&&(e.val(t.values[0].value),e.show())},prepareToSend:function(){this.object.find("input:text[value='']").attr("disabled",!0)},afterPrepareToSend:function(){this.object.find("input:text[value='']").attr("disabled",!1)},loadSolve:function(){var a=this,s=!0;this.main(),0<this.inputs.length?this.inputs.each(function(e,t){var n=a.getAnswer(t);if(n&&!n.correct)return s=!1}):s=!1,s&&this.inputs.each(function(e,t){var n=a.getAnswer(t),s=$(t);if(n.correct){var r={_hideOnly:!1,_clone:n.values[0].value},i=a.getHTMLValueForInput(s,n.values[0].value);a.insertStudentAnswers(s,[{_class:a.classes.correct,_value:i}],r),s.val(n.values[0].value),a.object.find("input:text[value='']").attr("disabled",!0)}})},getAnswer:function(e){var t=$(e),n=this.getResponseIdForInput(t);return this.getStudentAnswers(n)},createElement:function(e,t,n){var s=$("<span>").append(t).addClass(n);$(e).after(s)},loadReport:function(){this.studentResponseArray=[],this._putStudentAnswers(),this.loadFeedbacks(),correctAnswers&&this._addCorrectAnswers()},_putStudentAnswers:function(){var i=this;this.object.find("input").not(".example").each(function(){var e,t=i.getResponseIdForInput(this),n=!0,s=i.getStudentAnswers(t),r=s.value;s.values&&s.values[0]&&(r=s.values[0].value),s&&0!==s.values.length?s.correct?e="correctAnswer":n=!(e="wrongAnswer"):n=!(e="noAnswer"),i.studentResponseArray.push(n),n&&e?i.createElement(this,r,e):s&&!1===s.correct&&i.createElement(this,r,e)})},_addCorrectAnswers:function(){var i=this;this.object.find("input").not(".example").each(function(e){var t,n,s=i.getResponseIdForInput(this),r=i.getCorrectResponses(s);0<i.object.find(".noAnswer").length?t="noAnswer":0<i.object.find(".wrongAnswer").length?t="unavailableAnswer":0<i.object.find(".correctAnswer").length&&(t=null),r&&t&&!i.studentResponseArray[e]&&(n=r[0],i.createElement(this,n,t))})},loadFeedbacks:function(){var e=this.object.find(".sentence"),n=this.object.find(".buttonFeedback");e.each(function(e,t){((t=$(t)).find(".noAnswer").length||t.find(".wrongAnswer").length)&&t.after(n[e])})},checkFilledAnswers:function(){return!!this.object.find('[name^="response"][value!=""]').length},loadPreview:function(){var n=this;this.object.find("input").not(".example").each(function(){var e=n.getResponseIdForInput(this),t=n.getCorrectResponses(e);t&&$(this).val(t).css("display","inline").attr("readonly","true")}),correctAnswers&&setTimeout($.proxy(function(){$.each(correctAnswers[this.id],$.proxy(this.addAlternativeAnswers,this))},this),0)}}),PSEAudiosubmitItem.prototype=$.extend(AudiosubmitItem.getInstance(),{init:function(){"use strict";if(window.onerror||(window.onerror=function(){}),AudiosubmitItem.executed=!1,AudiosubmitItem.inputBefore&&AudiosubmitItem.inputBefore.remove(),!AudiosubmitItem.initialized||player.reinitialization){if(AudiosubmitItem.getLearnosityData()===this.currentActivityData)return;this.currentActivityData=AudiosubmitItem.getLearnosityData(),AudiosubmitItem.init(PSEAudiosubmitItem.options),AudiosubmitItem.initialized=!0}AudiosubmitItem.userAnsweredAudio=!1},checkFilledAnswers:function(){return AudiosubmitItem.notRecordedAudioPrompt=!0,AudiosubmitItem.userAnsweredAudio},prepareToSend:function(e,t){"use strict";return AudiosubmitItem.iteration===e||(AudiosubmitItem.iteration=e,PSEAudiosubmitItem.prepareToSend(t))}}),$.extend(PSEAudiosubmitItem,{preSuccess:function(){"use strict";return AudiosubmitItem.executed=!1,function(e){if(!AudiosubmitItem.executed){var i=$("form.solvingForm"),a=AudiosubmitItem.initObject.getResponses();$(".lrn_widget[id]").each(function(){var e=$(this),t={},n=e.closest("li.item").attr("id").substring(4),s=e.attr("id"),r="response["+n+"]["+s.substring(s.lastIndexOf("-")+1)+"]";void 0!==a[s]&&void 0!==a[s].uris&&void 0!==a[s].uris.au&&(t={length:a[s].length,created:a[s].created,au:a[s].uris.au}),AudiosubmitItem.inputBefore=$("<input>").attr("type","hidden").attr("name",r).val(JSON.stringify(t)).appendTo(i)}),AudiosubmitItem.executed=!0}e()}}(),initWithResume:function(){LearnosityApp.reset(),this.clearWidgets(),learnosityActivityData.state="resume",AudiosubmitItem.init(PSEAudiosubmitItem.options)},clearWidgets:function(){var n,s;$.each(AudiosubmitItem.storedTemplates,function(e,t){t.learnosity_id=t.response_id,t.ui_style.startRecording=!1,t.record_attempts=0,t.counter=null,n=$("#"+t.learnosity_id),(s=$('<span class="learnosity-response"></span>')).data("learnosity",t),s.data("begin",!1),n.parent().append(s),n.remove()})},prepareToSend:function(t){"use strict";var n=this,s=t.success;return window.lernosityProtectTimer=!1,t.success=function(){n.stopTimer(),n.preSuccess(s)},t.error=function(e){window.onerror(e.msg,"EquipmentCheck",0),n.stopTimer(),n.preSuccess(s)},this.nextButton=$("form.solvingForm").find(":submit"),t.progress=function(e){n.showUploadProgress(e),0!==e.percentage||window.lernosityProtectTimer||n.startTimer(t.success)},LearnosityApp.save(t),"wait"},showUploadProgress:function(e){"use strict";this.nextButton&&this.nextButton.val(Translator.trans("activity.uploading")+" "+e.percentage+"%")},startTimer:function(e){that=this;window.lernosityProtectTimer=setTimeout(function(){that.resumeWithMessage(e)},15e3)},resumeWithMessage:function(n){that=this,require(["common/dialogs/manager"],function(e){var t=(new e).make({key:"response_id_conflict",type:"info",content:Translator.trans("gse.learnosity.upload_still_in_progress")});t.removeAllButtons(),t.addButton(Translator.trans("gse.activity.wait"),function(e){window.lernosityProtectTimer=!1,e.close()}),t.addButton(Translator.trans("gse.activity.next_question"),function(e){window.lernosityProtectTimer=!0,e.close(),n()})})},stopTimer:function(){clearTimeout(window.lernosityProtectTimer),window.lernosityProtectTimer=!1}}),PSEAudiosubmitItem.options=$.extend({},AudiosubmitItem.options,{errorListener:function(e){"use strict";$("#pseSubmit").prop("disabled",!1),window.onerror&&window.onerror(e.msg,"PSEAudiosubmitItem",0),player.settings.onError&&(10002===e.code?(message(Translator.trans("gse.learnosity.response_id_conflict"),{object:$('<div class="ui-dialog-content"><p></p></div>'),dialogClass:"response_id_conflict",buttons:{NEXT:{text:Translator.trans("activity.next"),click:function(){$(this).dialog("close"),player.send()}}}}),PSEAudiosubmitItem.initWithResume()):player.settings.onError(e))},readyListener:function(){"use strict";if("solve"===window.viewMode){$.each([".describeImage.begin",".readingAndSpeaking.begin"],function(e,t){$("div"+t+" .lrn_audio").each(function(e,t){AudiosubmitItem.initObject.question(t.id).begin()})});var n=(e=player,t=attemptId,s=baseUrl,e.settings.learnosityRoutingUrl?Routing.generate("ioki_lti_play",{id:t}):s+"/gse_attempt/"+t+"/asset_check");$.each([".describeImage",".readingAndSpeaking",".conversation",".listenAndRepeat",".storyRetell",".passageComprehension"],function(e,t){$("div"+t+" .lrn_audio").each(function(e,t){AudiosubmitItem.initObject.question(t.id).on("recording:started",function(){AudiosubmitItem.userAnsweredAudio=!0,$.post(n,r($(t)))})})}),$(".lrn_start_playback").on("click",function(){var e=r($(this));e&&$.post(n,e),$(this).closest(".passageComprehension").find(".lrn_audio").each(function(e,t){AudiosubmitItem.initObject.question(t.id).begin(),$("#pseSubmit").prop("disabled",!0)})}),require(["platform/Activities/Formats/PSE/Passages/control/passages"],function(e){new e(".passageComprehension")}),player.unLockForm()}var e,t,s,r=function(e){var t,n;return n=e.closest(".task").attr("id").substring(5),(t=e.closest(".referenceObject").length?e.closest(".itemAsset").children(":first-child").data("audio-id"):e.closest(".item").attr("id").substring(4))?{taskQtiId:n,elementId:t}:null}}}),PSEAudiosubmitItem.options.labelBundle=$.extend(PSEAudiosubmitItem.options.labelBundle,{audioRecorder:"RECORD",audioPlayer:"PLAY",playing:"Playing",clickToRecord:"Ready",clickToStartPlayback:"Ready",recordingComplete:"Complete",maxPlayAttempts:"Complete",recordingCounterPreload:"Beginning in ..."}),ReorderItem.prototype=$.extend(DraggableJumbledWordsItem.getInstance(),{loadReport:function(){var i=this.object.find(".wordpoolWrapper"),e=this.object.find(".droppableWrapper");if(this.object.parent().hasClass("itemExample")||e.find(".example").remove(),"object"==("undefined"==typeof studentAnswers?"undefined":_typeof(studentAnswers))){var t=this.getResponseIdForInput(e.find('input[name^="response"]')),a=[],n=!!t&&this.getStudentAnswers(t);if(n&&($.each(n.values,function(e,t){if(words=t.value.split(" "),2==words.length){if(0==e){var n=i.find("[value="+words[0]+"]").html();a.push({_class:"firstAnswer",_value:n})}var s,r=i.find("[value="+words[1]+"]").html();s=t.correct?"correctAnswer":"wrongAnswer",a.unshift({_class:s,_value:r})}}),e.prepend("<span></span>"),this.insertStudentAnswers(e.find("span:eq(0)"),a,{_answers:[]}),!i.hasClass("avoidCapitalization"))){var s=e.find(".firstAnswer:eq(0)");s.html(this.setUpperCase(s.html()))}e.css({border:"0px solid #cbcbcb",background:"none"})}i.find(".drag").addClass("disabled")},insertResumedAnswer:function(e){var n;if(wordpoolWrapper=this.object.find(".wordpoolWrapper"),droppableWrapper=this.object.find(".droppableWrapper"),!droppableWrapper.children().hasClass("correctAnswer")){var s=this.getResumedAnswers(this.getResponseIdForInput(e));s&&s.values&&s.values.length&&$(s.values).each(function(e,t){n=t.value.split(" ")[0],wordpoolWrapper.find("[value="+n+"]").not(".example").appendTo(droppableWrapper),e===s.values.length-1&&(n=t.value.split(" ")[1],wordpoolWrapper.find("[value="+n+"]").not(".example").appendTo(droppableWrapper))})}this.upperCaseResumedLetters(droppableWrapper)}}),RecallAPassageItem.prototype=$.extend(EssayItem.getInstance(),{checkFilledAnswers:function(){return!0},addWordCount:function(){}}),ShortWritingItem.prototype=$.extend(EssayItem.getInstance(),{checkFilledAnswers:function(){return!0}}),DictationItem.prototype=$.extend(EssayItem.getInstance(),{loadSolve:function(){},checkFilledAnswers:function(){return!0},loadReport:function(){var e=this.object.find("textarea"),t=this.getResponseIdForInput(e),n=this.getStudentAnswers(t),r=$("<div>").addClass("answer dictationReport").attr("style",e.attr("style"));n&&$.each(n.values,function(e,t){var n=t.correct?"correctAnswer":"wrongAnswer",s=$("<div>").addClass(n).append(t.value);r.append(s)}),e.after(r),e.remove()},insertResumedAnswer:function(e){if(!e.next().hasClass("correctAnswer")){var t=this.getResumedAnswers(this.getResponseIdForInput(e));if(t.values&&t.values.length){var s="";$.each(t.values,function(e,t){if(e)s+=" "+t.value;else{var n=t.value;s+=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}}),e.html(s)}}}}),ErrorCorrectionItem.prototype=$.extend(SingleChoiceItem.getInstance(),{}),define("platform/Activities/Formats/PSE/Passages/control/passages",["can"],function(a){"use strict";return a.Control({defaults:{nextInteractionAttr:"data-next-interaction",audioClass:".lrn_audio",itemClass:".item",stopRecordingEvent:"recording:stopped",submitEl:a.$("#pseSubmit"),passageClass:".passageComprehension",audiosubmitItem:AudiosubmitItem,validPassagesNum:3,pauseAfterRecord:2e3}},{init:function(){var n,s,r,i=this;this.validPassagesNum()&&this.element.each(function(e,t){r=a.$(t),n=i.getNextInteraction(r),s=i.getAudioEl(r),n?i.setAudioAction(s,r,n):i.afterLastAudio(s)})},getNextInteraction:function(e){return e.attr(this.options.nextInteractionAttr)},validPassagesNum:function(){return this.element.length===this.options.validPassagesNum},getAudioEl:function(e){return e.find(this.options.audioClass)},setAudioAction:function(e,n,s){var r=this;e.each(function(e,t){r.options.audiosubmitItem.initObject.question(t.id).on(r.options.stopRecordingEvent,function(){setTimeout(function(){r.stopRecording(n,s)},r.options.pauseAfterRecord)})})},afterLastAudio:function(e){var t=this;t.options.audiosubmitItem.initObject.question(e[0].id).on(t.options.stopRecordingEvent,function(){t.options.submitEl.prop("disabled",!1)})},stopRecording:function(e,t){var n=this,s=a.$(this.getNextPassage(t));e.closest(this.options.itemClass).hide(),this.getAudioEl(s).each(function(e,t){n.options.audiosubmitItem.initObject.question(t.id).begin()})},getNextPassage:function(e){return a.$(this.options.passageClass+'[data-uid="'+e+'"]')}})});
//# sourceMappingURL=scripts-formats.min.js.map